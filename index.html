<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Bio-Trek</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap" rel="stylesheet"/>
  
<style>
  :root {
    --card-img-h: 240px;
  }

  html,
  body {
    margin: 0;
    padding: 0;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    color: #f5f5f5;
    background:
      radial-gradient(circle at 20% 0%, rgba(76, 106, 187, 0.35), transparent 55%),
      radial-gradient(circle at 80% 10%, rgba(200, 70, 150, 0.25), transparent 60%),
      linear-gradient(to bottom, #0c1632 0%, #05091c 100%);
  }

  body.bio-open {
    background: linear-gradient(to bottom, #000019 0%, #000009 100%);
  }

  }

  body::before {
    content: "";
    position: fixed;
    inset: 0;
    pointer-events: none;
    opacity: 0.28;
    background-image:
      radial-gradient(2px 2px at 10% 20%, #ffffff, transparent),
      radial-gradient(1.5px 1.5px at 40% 80%, #e0f0ff, transparent),
      radial-gradient(1.8px 1.8px at 80% 30%, #fffbe0, transparent);
  }

  header {
    position: relative;
    padding: 0.6rem 1rem 0.15rem;
    text-align: center;
    overflow: hidden;
  }

header::after {
    content: "";
    position: absolute;
    inset: 0;
    margin: 0 auto;
    max-width: 820px;
    pointer-events: none;
    background:
      radial-gradient(circle at 50% 0%, rgba(0, 0, 0, 0.7), transparent 65%);
    opacity: 0.9;
    mix-blend-mode: normal;
  }

header::before {
    content: "";
    position: absolute;
    inset: 10% 0 auto;
    margin: 0 auto;
    width: 280px;
    height: 420px;
    background:
      radial-gradient(circle at 20% 20%, rgba(255, 215, 0, 0.15), transparent 55%),
      linear-gradient(150deg, rgba(255, 215, 0, 0.28), transparent 60%);
    clip-path: polygon(50% 0%, 80% 85%, 50% 100%, 20% 85%);
    opacity: 0.13;
    filter: blur(0.4px);
    pointer-events: none;
  }

  .header-ship {
    position: fixed;
    top: 1.5rem;
    right: 1.25rem;
    display: none;
    max-height: 240px;
    width: auto;
    pointer-events: none;
    z-index: 200;
  }

  main {
    flex: 1;
    display: flex;
    justify-content: center;
    padding: 0.75rem 1rem 0.75rem;
  }

  .series-wrapper {
    width: 100%;
    max-width: 1400px;
    position: relative;
  }

  .title-main {
    font-family: "Orbitron", sans-serif;
    font-size: 36pt;
    margin: 0 0 0.2rem;
    letter-spacing: 0.2em;
    background: linear-gradient(120deg, #fffef5, #ffe977, #ffcF2a);
    -webkit-background-clip: text;
    background-clip: text;
    color: #fff8d0;
    -webkit-text-stroke: 3px #000000;
    text-shadow:
      0 0 4px #000000,
      0 0 16px rgba(255, 235, 170, 1),
      0 0 34px rgba(255, 235, 170, 0.98),
      0 0 52px rgba(255, 235, 170, 0.8);
  }

  .subtitle-main {
    font-family: "Orbitron", sans-serif;
    font-size: 17pt;
    margin: 0;
    letter-spacing: 0.22em;
    text-transform: uppercase;
    color: #ffd700;
    text-shadow:
      0 0 4px #000000,
      0 0 10px rgba(255, 215, 0, 0.7);
  }

  h1.title-main::after {
    content: "";
    display: block;
    width: 260px;
    height: 2px;
    margin: 8px auto 0;
    border-radius: 999px;
    background: linear-gradient(90deg, transparent, #f6e27a, #f2c14f, transparent);
    box-shadow: 0 0 12px rgba(242, 193, 79, 0.9);
  }

  .series-grid {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    margin-top: 8px;
    height: calc(100vh - 210px);
  }

  .series-grid .button-row:nth-child(1) {
    margin-top: 0;
  }

  .series-grid .button-row:nth-child(2),
  .series-grid .button-row:nth-child(3),
  .series-grid .button-row:nth-child(4),
  .series-grid .button-row:nth-child(5) {
    margin-top: 18px;
  }

  .series-grid .button-row:nth-child(6) {
    margin-top: auto;
  }

  .series-grid .button-row:nth-child(1),
  .series-grid .button-row:nth-child(2),
  .series-grid .button-row:nth-child(3),
  .series-grid .button-row:nth-child(4),
  .series-grid .button-row:nth-child(5) {
    transform: translateY(20px);
  }



  .button-row {
    display: flex;
    gap: 1.5rem;
    justify-content: center;
    width: 100%;
    max-width: 1100px;
  }

  .button-row + .button-row {
    margin-top: 0;
  }

  .series-btn {
    position: relative;
    overflow: hidden;
    display: inline-flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    width: 100%;
    padding: 0.8rem 1.4rem;
    border-radius: 999px;
    border: 1px solid rgba(255, 255, 255, 0.4);
    font-size: 12pt;
    font-weight: 700;
    letter-spacing: 0.03em;
    background-image: none;
    background-color: #020819;
    color: #f6e27a;
    backdrop-filter: blur(14px);
    -webkit-backdrop-filter: blur(14px);
    transform: perspective(600px) translateY(0);
    box-shadow:
      0 8px 0 #000000,
      0 22px 40px rgba(0, 0, 0, 0.98),
      inset 0 1px 0 rgba(255, 255, 255, 0.35),
      inset 0 -4px 14px rgba(0, 0, 0, 0.9);
    cursor: pointer;
    text-shadow: none;
    transition:
      transform 0.16s,
      box-shadow 0.16s,
      border-color 0.16s,
      background-color 0.16s;
  }


  .series-btn.story-arcs-btn,
  .series-btn.episode-guide-btn {
    width: 48%;
    margin: 0 auto;
  }

  .series-btn.stunts-btn,
  .series-btn.production-btn {
    width: 48%;
    margin: 0 auto;
  }

  .series-btn::before {
    content: "";
    position: absolute;
    left: 8px;
    top: 18%;
    bottom: 18%;
    width: 5px;
    border-radius: 999px;
    background: #ffd700;
  }
  .series-btn::after {
    content: "";
    position: absolute;
    inset: 0;
    top: 0;
    height: 40%;
    background: linear-gradient(
      to bottom,
      rgba(255,255,255,0.16),
      rgba(255,255,255,0.04),
      transparent 100%
    );
    mix-blend-mode: screen;
    pointer-events: none;
    transition: transform 0.35s ease-out, opacity 0.2s ease-out;
    transform: translateX(0);
    opacity: 0.85;
  }

  .series-btn:hover::after {
    transform: translateX(18%);
    opacity: 1;
  }

  .series-btn:hover::after {
    transform: translateX(16%);
  }

  .series-btn-placeholder::before {
    background: #ded8ab;
  }

  .series-btn[data-series="The Original Series"]::before {
    background: #8aaae5;
  }

  .series-btn[data-series="The Next Generation"]::before {
    background: #ffffff;
  }

  .series-btn[data-series="Deep Space Nine"]::before {
    background: #cc2c34;
  }

  .series-btn[data-series="Voyager"]::before {
    background: #218c4a; 
  }

  .series-btn[data-series="Enterprise"]::before {
    background: #998209;
  }

  .series-btn[data-series="Discovery"]::before {
    background: #55b53b;
  }

  .series-btn[data-series="Picard"]::before {
    background: #ffff00;
  }

  .series-btn[data-series="Strange New Worlds"]::before {
    background: #89acd1;
  }

  .series-btn:hover {
    transform: perspective(600px) rotateX(3deg) rotateY(-3deg) translateY(-2px);
    box-shadow:
      0 6px 0 #000000,
      0 22px 40px rgba(0, 0, 0, 0.98),
      inset 0 0 0 1px rgba(255, 255, 255, 0.18),
      inset 0 0 28px rgba(255, 215, 0, 0.55);
    border-color: #ffd700;
  }

  .series-btn.active {
    border-color: #3dd8ff;
    box-shadow:
      0 6px 0 #000000,
      0 22px 40px rgba(0, 0, 0, 0.98),
      inset 0 0 0 1px rgba(61, 216, 255, 0.7),
      inset 0 0 24px rgba(61, 216, 255, 0.55);
  }

  .return-link {
    display: none;
    align-items: center;
    gap: 0.4rem;
    padding: 0.25rem 0.9rem;
    border-radius: 999px;
    background:
      radial-gradient(circle at 0 50%, rgba(61, 216, 255, 0.45), transparent 55%),
      linear-gradient(90deg, rgba(2, 6, 24, 0.99), rgba(7, 26, 68, 0.98));
    border: 1px solid rgba(61, 216, 255, 0.85);
    font-size: 0.78rem;
    letter-spacing: 0.16em;
    text-transform: uppercase;
    color: #f6e27a;
    margin: 0 0 1rem;
    cursor: pointer;
  }

  .return-link::before {
    content: "⟵";
    font-size: 0.9rem;
  }

  .cards-grid {
    display: none;
    flex-direction: column;
    align-items: center;
    margin-top: 40px;
  }

  .cards-row {
    display: flex;
    flex-wrap: wrap;
    gap: 1.5rem;
    justify-content: center;
    width: 100%;
    max-width: 1100px;
  }

  .character-card {
    flex: 0 1 18%;
    max-width: 260px;
    padding: 1.5rem 1.75rem;
    border-radius: 22px;
    background-image: linear-gradient(145deg, #07152b 0%, #12527a 40%, #0a8cc0 100%);
    border: 1px solid rgba(255, 255, 255, 0.45);
    color: #f6e27a;
    font-size: 12pt;
    letter-spacing: 0.04em;
    text-transform: uppercase;
    text-align: center;
    box-shadow:
      0 10px 0 #000000,
      0 26px 50px rgba(0, 0, 0, 1),
      inset 0 1px 0 rgba(255, 255, 255, 0.28),
      inset 0 -4px 14px rgba(0, 0, 0, 0.9);
    transition:
      transform 0.16s,
      box-shadow 0.16s,
      border-color 0.16s;
    cursor: pointer;
    display: flex;
    flex-direction: column;
    gap: 0.65rem;
    position: relative;
  }
  .character-card::after {
    content: "";
    position: absolute;
    inset: 0;
    border-radius: inherit;
    background:
      linear-gradient(
        to bottom,
        rgba(255,255,255,0.16) 0%,
        rgba(255,255,255,0.06) 18%,
        rgba(0,0,0,0.28) 55%,
        rgba(0,0,0,0.7) 100%
      );
    pointer-events: none;
  }

  .character-card::before {
    content: "";
    position: absolute;
    top: 0;
    right: 0;
    width: 34px;
    height: 34px;
    background: transparent;
    border-bottom-left-radius: 18px;
    box-shadow:
      -18px 18px 0 0 rgba(2, 6, 29, 1),
      -18px 18px 0 1px rgba(255, 215, 0, 0.3);
    opacity: 0.9;
    pointer-events: none;
  }

  .character-card:hover {
    transform: translateY(-2px) scale(1.01);
    box-shadow:
      0 6px 0 #000000,
      0 22px 40px rgba(0, 0, 0, 0.98),
      inset 0 0 0 1px rgba(255, 255, 255, 0.12),
      inset 0 -3px 12px rgba(0, 0, 0, 0.98);
  }

  .character-card > img {
    display: block;
    width: 100%;
    height: var(--card-img-h);
    object-fit: cover;
    border-radius: 10px;
    box-shadow:
      0 0 0 1px rgba(0,0,0,0.95),
      0 0 22px rgba(0,0,0,0.95),
      0 0 36px rgba(0,0,0,0.85);
  }

  .card-text {
    display: flex;
    flex-direction: column;
    gap: 4px;
    min-height: 72px;
    text-align: center;
    align-items: center;
    padding: 0.55rem 0.5rem;
    border-radius: 12px;
    background: #f5f6fb;
    box-shadow:
      0 0 0 1px rgba(0,0,0,0.35),
      0 3px 6px rgba(0,0,0,0.45);
    width: calc(100% + 12px);
    margin: 0 -6px;
  }

  .card-text a {
    text-decoration: none;
  }

  a:hover,
  a:focus-visible {
    text-decoration: underline;
  }

  .card-text .character-name,
  .card-text .character-actor,
  .bio-overlay-main a {
    cursor: pointer;
  }

  .card-text .character-name {
    position: relative;
    display: inline-flex;
    align-items: center;
    gap: 0.45rem;
    color: #111827;
    font-weight: 800;
    font-size: 1.02rem;
  }

  .card-text .character-title {
    color: #ff9b1a;
    font-size: 0.95rem;
    margin: 0;
    -webkit-text-stroke: 0.4px #000000;
    text-shadow:
      0 0 1px #000000,
      0 0 2px rgba(0,0,0,0.7);
  }

  .card-text .character-actor {
    color: #064e3b;
    font-weight: 700;
    font-size: 0.9rem;
  }

  .series-non-tos .character-card.tos-only {
    display: none;
  }

  
  #bio-overlay {
    max-width: 1200px;
    margin: 32px auto;
    padding: 0;
    position: relative;
    border-radius: 20px;
    border: 1px solid rgba(96, 196, 255, 0.8);
    box-shadow:
      0 18px 50px rgba(0,0,0,0.95),
      0 0 0 1px rgba(3, 12, 26, 0.9);
    background-color: #020713;
    overflow: hidden;
  }

  #bio-overlay::before {
    content: "";
    position: absolute;
    inset: 0;
    border-radius: inherit;
    border: 1px solid rgba(191, 213, 255, 0.12);
    pointer-events: none;
  }

  .bio-overlay-inner {
    display: flex;
    flex-direction: column;
    min-height: 0;
  }

  .bio-overlay-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0.9rem 1.5rem;
    border-bottom: 1px solid rgba(120, 190, 255, 0.5);
    background: radial-gradient(circle at 0% 0%, rgba(255,255,255,0.14), transparent 55%),
                linear-gradient(120deg, rgba(1,11,28,0.96), rgba(0,28,54,0.98));
  }

  .bio-overlay-title {
    display: flex;
    flex-direction: column;
    gap: 0.15rem;
  }

  .bio-overlay-title-main {
    font-family: "Orbitron", sans-serif;
    font-size: 1.15rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: #ffffff;
  }

  .bio-overlay-title-sub {
    font-size: 0.8rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: rgba(200, 222, 255, 0.85);
  }

  .bio-overlay-main {
    display: flex;
    gap: 2.2rem;
    padding: 1.3rem 1.8rem 1.5rem;
    align-items: flex-start;
  }

  .bio-image-col {
    flex: 0 0 auto;
  }

  .bio-text-col {
    flex: 1 1 auto;
    padding-right: 0.2rem;
  }

  .bio-text-col h3 {
    margin-top: 0.9rem;
  }

  .bio-text-col p {
    margin-top: 0.25rem;
  }

  .bio-overlay-footer {
    display: flex;
    justify-content: center;
    gap: 0.75rem;
    padding: 0.9rem 1.4rem 1.3rem;
    border-top: 1px solid rgba(120, 190, 255, 0.5);
    background: linear-gradient(180deg, rgba(3,15,35,0.96), rgba(0,8,18,0.98));
  }

  @media (max-width: 980px) {
    .bio-overlay-main {
      flex-direction: column;
      padding: 1.1rem 1.2rem 1.3rem;
    }
    .bio-text-col {
      max-height: none;
      padding-right: 0;
    }
  }

  @media (max-width: 720px) {
    #bio-overlay {
      margin: 20px auto;
    }
    .bio-overlay-header {
      padding: 0.7rem 0.9rem;
    }
    .bio-overlay-main {
      padding: 0.9rem 0.9rem 1.1rem;
    }
    .bio-overlay-footer {
      padding: 0.8rem 0.9rem 1.0rem;
    }
  }

  #bio-overlay .bio-flex-row {
    display: flex;
    gap: 2rem;
    align-items: flex-start;
  }

  #bio-overlay .bio-image-col {
    flex: 0 0 auto;
  }

  #bio-overlay .bio-text-col {
    flex: 1 1 auto;
  }

  #bio-overlay::before {
    content: "";
    position: absolute;
    inset: 0;
    border-radius: 18px;
    background-image: repeating-linear-gradient(
      to bottom,
      rgba(255,255,255,0.04) 0px,
      rgba(255,255,255,0.04) 1px,
      transparent 2px,
      transparent 3px
    );
    opacity: 0.35;
    mix-blend-mode: soft-light;
    pointer-events: none;
  }

  #bio-overlay::after {
    content: "";
    position: absolute;
    inset: 6px;
    border-radius: 14px;
    box-shadow:
      0 0 10px rgba(61,216,255,0.8),
      0 0 24px rgba(242,193,79,0.55);
    opacity: 0.75;
    pointer-events: none;
  }

  #bio-overlay::before {
    content: "";
    position: absolute;
    inset: 0;
    border-radius: 18px;
    background-image: repeating-linear-gradient(
      to bottom,
      rgba(255,255,255,0.04) 0px,
      rgba(255,255,255,0.04) 1px,
      transparent 2px,
      transparent 3px
    );
    opacity: 0.35;
    mix-blend-mode: soft-light;
    pointer-events: none;
  }

  #bio-overlay::after {
    content: "";
    position: absolute;
    inset: 6px;
    border-radius: 14px;
    box-shadow:
      0 0 8px rgba(61,216,255,0.6),
      0 0 18px rgba(242,193,79,0.45);
    opacity: 0.7;
    pointer-events: none;
  }

  .bio-header,
  h1,
  h2,
  h3,
  h4,
  h5,
  h6 {
    color: gold;
    font-weight: 700;
  }

  a[data-related-bio] {
    color: #D97A2B;
  }

  .btn-title {
    font-size: 1.05rem;
    font-weight: 700;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    line-height: 1.1;
  }

  .btn-subtitle {
    margin-top: 0.3rem;
    font-size: 0.92rem;
    font-weight: 500;
    letter-spacing: 0.04em;
    text-transform: none;
    line-height: 1.25;
    opacity: 0.98;
  }

  .series-btn-people .btn-title {
    color: #f6e27a;
  }

  .series-btn-people .btn-subtitle {
    color: #fdf6c9;
  }

  .series-btn-stories .btn-title {
    color: #f4d03f;
  }

  .series-btn-stories .btn-subtitle {
    color: #ffffff;
  }

  .series-btn-episodes .btn-title {
    color: #f4d03f;
  }

  .series-btn-episodes .btn-subtitle {
    color: #ffffff;
  }

  .series-btn-people {
    background-color: #020b23;
    border-color: rgba(244, 208, 63, 0.85);
    box-shadow:
      0 10px 0 #000000,
      0 26px 46px rgba(0, 0, 0, 0.98),
      inset 0 1px 0 rgba(255, 255, 255, 0.32),
      inset 0 -6px 16px rgba(0, 0, 0, 0.95);
  }

  .series-btn-people::after {
    content: "";
    position: absolute;
    inset: 4px 10px;
    top: 4px;
    height: 54%;
    border-radius: 999px;
    background:
      radial-gradient(circle at 50% 0, rgba(180, 230, 255, 0.4), transparent 62%);
    opacity: 0.65;
    pointer-events: none;
    mix-blend-mode: screen;
  }


  
  .series-btn-stories::after {
    content: "";
    position: absolute;
    inset: 4px 10px;
    top: 4px;
    height: 54%;
    border-radius: 999px;
    background:
      radial-gradient(circle at 50% 0, rgba(180, 230, 255, 0.4), transparent 62%);
    opacity: 0.65;
    pointer-events: none;
    mix-blend-mode: screen;
  }

  .series-btn-episodes::after {
    content: "";
    position: absolute;
    inset: 4px 10px;
    top: 4px;
    height: 54%;
    border-radius: 999px;
    background:
      radial-gradient(circle at 50% 0, rgba(180, 230, 255, 0.4), transparent 62%);
    opacity: 0.65;
    pointer-events: none;
    mix-blend-mode: screen;
  }

.series-btn-people::before {
    background: #f4d03f;
  }

  .series-btn-stories {
    background-color: #8b5a2b;
    border-color: rgba(255, 204, 128, 0.95);
    text-shadow: none;
  }

  .series-btn-stories::before {
    background: #ff9b3c;
  }

  .series-btn-episodes {
    background-color: #1d4f33;
    border-color: rgba(196, 255, 156, 0.95);
  }

  .series-btn-episodes::before {
    background: #3dd8ff;
  }



  
  .series-btn-people[data-series="The Original Series"] {
    background-color: #04152b;
  }

  .series-btn-people[data-series="The Next Generation"] {
    background-color: #05203c;
  }

  .series-btn-people[data-series="Deep Space Nine"] {
    background-color: #03172b;
  }

  .series-btn-people[data-series="Voyager"] {
    background-color: #041b32;
  }

  .series-btn-people[data-series="Enterprise"] {
    background-color: #031426;
  }

  .series-btn-people[data-series="Discovery"] {
    background-color: #02192f;
  }

  .series-btn-people[data-series="Picard"] {
    background-color: #031c30;
  }

  .series-btn-people[data-series="Strange New Worlds"] {
    background-color: #021a35;
  }

  .series-btn-people[data-series="Guest List"] {
    background-color: #020f22;
  }

  .series-btn-people[data-series="Behind the Camera"] {
    background-color: #3a3a3a;
  }

  .series-btn-people[data-series="Stunts & Stand-Ins"] {
    background-color: #4a4a4a;
  }

  .header-nav-btn {
    position: absolute;
    top: 0.65rem;
    padding: 0.5rem 1.8rem;
    border-radius: 999px;
    border: 1px solid rgba(255, 255, 255, 0.4);
    font-size: 14pt;
    font-weight: 700;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    cursor: pointer;
    white-space: nowrap;
    background-color: #020819;
    background-image:
      radial-gradient(circle at 0% 0%, rgba(255, 255, 255, 0.35) 0, rgba(255, 255, 255, 0) 52%),
      radial-gradient(circle at 100% 100%, rgba(255, 255, 255, 0.12) 0, rgba(0, 0, 0, 0.85) 55%);
    color: #f6e27a;
    backdrop-filter: blur(14px);
    -webkit-backdrop-filter: blur(14px);
    transform: perspective(600px) translateY(0);
    box-shadow:
      0 6px 0 #000000,
      0 18px 32px rgba(0, 0, 0, 0.95),
      inset 0 1px 0 rgba(255, 255, 255, 0.35),
      inset 0 -4px 14px rgba(0, 0, 0, 0.9);
    text-shadow: none;
    transition:
      transform 0.16s,
      box-shadow 0.16s,
      border-color 0.16s,
      background-color 0.16s;
  }

  
  
  
  
  
  
  .header-nav-btn-left {
    left: 1rem;
    background: #333333;
    color: #e7b82c;
  }

  
  .header-nav-btn-right {
    right: 1rem;
    background: #a68164;
    color: #fdfdfd;
  }

  .header-nav-btn:hover {
    filter: brightness(1.08);
    transform: perspective(600px) translateY(-1px);
    box-shadow:
      0 7px 0 #000000,
      0 20px 36px rgba(0, 0, 0, 0.97),
      inset 0 1px 0 rgba(255, 255, 255, 0.45),
      inset 0 -4px 16px rgba(0, 0, 0, 0.95);
  }

  .header-nav-btn:active {
    filter: brightness(0.95);
    transform: perspective(600px) translateY(1px);
    box-shadow:
      0 3px 0 #000000,
      0 10px 20px rgba(0, 0, 0, 0.9),
      inset 0 1px 0 rgba(255, 255, 255, 0.2),
      inset 0 -2px 8px rgba(0, 0, 0, 0.9);
  }



  /* Badge 1 LCARS gold styling override */
  .character-card {
    background-color: #d4af37;
    background-image: none;
  }

  .character-card:hover {
    transform: none;
  }

  .card-text {
    display: flex;
    flex-direction: column;
    gap: 4px;
    min-height: 72px;
    text-align: left;
    align-items: flex-start;
    padding: 1.6rem 1.1rem 1.0rem 2.5rem;
    border-radius: 18px;
    background: #050814;
    box-shadow:
      0 0 0 1px #b8911f,
      0 10px 18px rgba(0,0,0,0.65),
      inset 0 1px 0 rgba(255,255,255,0.12);
    width: calc(100% - 10px);
    margin: 0 auto;
    position: relative;
  }

  .card-text::before {
    content: "";
    position: absolute;
    left: 0.8rem;
    top: 0.7rem;
    bottom: 0.7rem;
    width: 11px;
    border-radius: 999px;
    background: linear-gradient(
      to bottom,
      #ff9b1a 0%,
      #ff9b1a 32%,
      #ff6ec7 32%,
      #ff6ec7 60%,
      #6ec1ff 60%,
      #6ec1ff 100%
    );
  }

  .card-text::after {
    content: "";
    position: absolute;
    left: 2.3rem;
    right: 1.0rem;
    top: 0.7rem;
    height: 8px;
    border-radius: 999px;
    background: #ff9b1a;
  }

  .character-card::before {
    content: none;
  }

  .character-card::after {
    content: "";
    position: absolute;
    inset: 0;
    border-radius: inherit;
    background: linear-gradient(
      to bottom,
      rgba(255,255,255,0.12) 0%,
      rgba(255,255,255,0.02) 45%,
      rgba(0,0,0,0) 100%
    );
    pointer-events: none;
  }

  .card-text .character-name {
    position: relative;
    display: inline-flex;
    align-items: center;
    gap: 0.45rem;
    color: #fffdf4;
    font-weight: 800;
    font-size: 1.08rem;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    text-shadow:
      0 0 4px rgba(0,0,0,0.9);
  }

  .card-text .character-title {
    color: #ffd67f;
    font-size: 0.95rem;
    margin: 0;
    text-transform: uppercase;
    -webkit-text-stroke: 0.4px #000000;
    text-shadow:
      0 0 1px #000000,
      0 0 2px rgba(0,0,0,0.7);
  }

  .card-text .character-actor {
    color: #e0f3ff;
    font-weight: 600;
    font-size: 0.9rem;
    text-shadow:
      0 0 3px rgba(0,0,0,0.9);
  }

  /* Badge 2 styling mirroring Badge 1 */
  .badge-2 {
    width: 260px;
    height: var(--card-img-h);
    border-radius: 22px;
    background-color: #d4af37;
    border: 1px solid rgba(255, 255, 255, 0.45);
    margin: 0 auto;
    position: relative;
    box-shadow:
      0 10px 0 #000000,
      0 26px 50px rgba(0, 0, 0, 1),
      inset 0 1px 0 rgba(255, 255, 255, 0.28);
    overflow: hidden;
  }

  .badge-2::before {
    content: "";
    position: absolute;
    top: 10px;
    left: 9px;
    right: 9px;
    bottom: 10px;
    border-radius: 18px;
    background-color: #050814;
    box-shadow:
      0 0 0 1px #b8911f,
      0 10px 18px rgba(0,0,0,0.65),
      inset 0 1px 0 rgba(255,255,255,0.12);
    background-image:
      linear-gradient(
        to bottom,
        #ff9b1a 0%,
        #ff9b1a 32%,
        #ff6ec7 32%,
        #ff6ec7 60%,
        #6ec1ff 60%,
        #6ec1ff 100%
      ),
      linear-gradient(
        to right,
        #ff9b1a 0%,
        #ff9b1a 100%
      );
    background-repeat: no-repeat;
    background-size:
      11px calc(100% - 1.4rem),
      calc(100% - 3.3rem) 8px;
    background-position:
      0.8rem 0.7rem,
      2.3rem 0.7rem;
  }

  .badge-2::after {
    content: "";
    position: absolute;
    inset: 0;
    border-radius: inherit;
    background: linear-gradient(
      to bottom,
      rgba(255,255,255,0.12) 0%,
      rgba(255,255,255,0.02) 45%,
      rgba(0,0,0,0) 100%
    );
    pointer-events: none;
  }

  .badge-2-text {
    position: relative;
    width: 100%;
    height: 100%;
    padding: 0;
    text-align: left;
  }

  .badge-2-name {
    position: absolute;
    left: 58px;
    top: 56px;
    display: block;
    color: #fffdf4;
    font-weight: 800;
    font-size: 1.08rem;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    text-shadow:
      0 0 4px rgba(0,0,0,0.9);
    margin: 0;
    max-width: 170px;
    padding-right: 4px;
    word-wrap: break-word;
  }

  .badge-2-role {
    position: absolute;
    left: 58px;
    bottom: 30px;
    color: #ffd67f;
    font-size: 0.95rem;
    margin: 0;
    text-transform: uppercase;
    -webkit-text-stroke: 0.4px #000000;
    text-shadow:
      0 0 1px #000000,
      0 0 2px rgba(0,0,0,0.7);
  }

  .badge-2-actor {
    position: absolute;
    left: 58px;
    top: 156px;
    color: #e0f3ff;
    font-weight: 600;
    font-size: 0.9rem;
    text-shadow:
      0 0 3px rgba(0,0,0,0.9);
  }

</style>

</head>
<body>
    <header>
    <h1 class="title-main">Bio Trek</h1>
    <h2 class="subtitle-main">Star Trek Biographies</h2>
    <img class="header-ship" src="https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Enterprise%20NCC-1701.png" alt="USS Enterprise silhouette">
  </header>  <main>
    <div class="series-wrapper">
      <div id="return-menu" class="return-link">Return to Main Menu</div>

      
      
      <div class="series-grid">
        <div class="button-row">
          <button type="button" class="series-btn series-btn-people" data-series="The Original Series">
            <span class="btn-title">The Original Series</span>
            <span class="btn-subtitle">Crew &amp; actor bios</span>
          </button>
          <button type="button" class="series-btn series-btn-people" data-series="The Next Generation">
            <span class="btn-title">The Next Generation</span>
            <span class="btn-subtitle">Crew &amp; actor bios</span>
          </button>
          <button type="button" class="series-btn series-btn-people" data-series="Deep Space Nine">
            <span class="btn-title">Deep Space Nine</span>
            <span class="btn-subtitle">Crew &amp; actor bios</span>
          </button>
        </div>
        <div class="button-row">
          <button type="button" class="series-btn series-btn-people" data-series="Voyager">
            <span class="btn-title">Voyager</span>
            <span class="btn-subtitle">Crew &amp; actor bios</span>
          </button>
          <button type="button" class="series-btn series-btn-people" data-series="Enterprise">
            <span class="btn-title">Enterprise</span>
            <span class="btn-subtitle">Crew &amp; actor bios</span>
          </button>
          <button type="button" class="series-btn series-btn-people" data-series="Discovery">
            <span class="btn-title">Discovery</span>
            <span class="btn-subtitle">Crew &amp; actor bios</span>
          </button>
        </div>
        <div class="button-row">
          <button type="button" class="series-btn series-btn-people" data-series="Picard">
            <span class="btn-title">Picard</span>
            <span class="btn-subtitle">Crew &amp; actor bios</span>
          </button>
          <button type="button" class="series-btn series-btn-people" data-series="Strange New Worlds">
            <span class="btn-title">Strange New Worlds</span>
            <span class="btn-subtitle">Crew &amp; actor bios</span>
          </button>
          <button type="button" class="series-btn series-btn-people" data-series="Guest List">
            <span class="btn-title">Guest List</span>
            <span class="btn-subtitle">Recurring &amp; guest characters</span>
          </button>
        </div>
        <div class="button-row">
          <button type="button" class="series-btn series-btn-people stunts-btn" data-series="Stunts &amp; Stand-Ins">
            <span class="btn-title">Stunts &amp; Stand-Ins</span>
            <span class="btn-subtitle">Stunt performers &amp; stand-ins</span>
          </button>
          <button type="button" class="series-btn series-btn-people production-btn" data-series="Behind the Camera">
            <span class="btn-title">Behind the Camera</span>
            <span class="btn-subtitle">Writers, producers &amp; creatives</span>
          </button>
        </div>
        <div class="button-row">
          <button type="button" class="series-btn series-btn-stories story-arcs-btn" data-series="Story Arcs">
            <span class="btn-title">Story Arcs</span>
            <span class="btn-subtitle">Multi-episode narrative threads</span>
          </button>
        </div>
        <div class="button-row">
          <button type="button" class="series-btn series-btn-episodes episode-guide-btn" data-series="Best Episodes">
            <span class="btn-title">Best Episodes</span>
            <span class="btn-subtitle">Hall of Fame episodes</span>
          </button>
          <button type="button" class="series-btn series-btn-episodes episode-guide-btn" data-series="Worst Episodes">
            <span class="btn-title">Worst Episodes</span>
            <span class="btn-subtitle">Hall of Shame episodes</span>
          </button>
        </div>
      </div>


      <div class="cards-grid">
        <div class="cards-row">
          <article class="character-card" id="card-1">
            <div id="card-1-text" class="card-text"></div>
          </article>
          <article class="character-card" id="card-2">
            <div id="card-2-text" class="card-text"></div>
          </article>
          <article class="character-card" id="card-3">
            <div id="card-3-text" class="card-text"></div>
          </article>

          
          <article class="character-card tos-only">
            <div class="card-text">
              <a class="character-name" href="#">Montgomery Scott</a>
              <p class="character-title">Chief Engineer</p>
              <a class="character-actor" href="#">James Doohan</a>
            </div>
          </article>
          <article class="character-card tos-only">
            <div class="card-text">
              <a class="character-name" href="#">Nyota Uhura</a>
              <p class="character-title">Communications Officer</p>
              <a class="character-actor" href="#">Nichelle Nichols</a>
            </div>
          </article>
          <article class="character-card tos-only">
            <div class="card-text">
              <a class="character-name" href="#">Hikaru Sulu</a>
              <p class="character-title">Helmsman</p>
              <a class="character-actor" href="#">George Takei</a>
            </div>
          </article>
          <article class="character-card tos-only">
            <div class="card-text">
              <a class="character-name" href="#">Pavel Chekov</a>
              <p class="character-title">Navigator</p>
              <a class="character-actor" href="#">Walter Koenig</a>
            </div>
          </article>
          <article class="character-card tos-only">
            <div class="card-text">
              <a class="character-name" href="#">Yeoman Janice Rand</a>
              <p class="character-title">Yeoman</p>
              <a class="character-actor" href="#">Grace Lee Whitney</a>
            </div>
          </article>
          <article class="character-card tos-only">
            <div class="card-text">
              <a class="character-name" href="#">Nurse Christine Chapel</a>
              <p class="character-title">Nurse</p>
              <a class="character-actor" href="#">Majel Barett Roddenberry</a>
            </div>
          </article>
        </div>
      </div>
    </div>
  </main>

  
  <div id="bio-overlay" style="display:none; padding:2rem 7.5rem; max-width:1200px; margin:50px auto;"></div>

  <script type="module">

    const $  = (s, r=document) => r.querySelector(s);
    const $$ = (s, r=document) => r.querySelectorAll(s);

    const titleEl = $(".title-main");
    const subtitleEl = $(".subtitle-main");
    const seriesMenu = $(".series-grid");
    const cardsGrid  = $(".cards-grid");
    const returnMenu = $("#return-menu");
    const bioOverlay = $("#bio-overlay");
    const headerShip = $(".header-ship");
    const headerNavLeft = $(".header-nav-btn-left");
    const headerNavRight = $(".header-nav-btn-right");
    let bioLinkState = null;
    let currentSeriesKey = "";
    let currentEpisodeMode = "best";
    let cachedEpisodesBest = null;
    let cachedEpisodesWorst = null;
    let cachedProdStunts = null;
    const PROD_STUNTS_URL = "https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Biographies/Production%20and%20Stunts.json";

    function esc(s){ return String(s).replace(/[&<>]/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;'}[m])); }
    function simpleNorm(s){ return String(s||'').toLowerCase().normalize('NFKD').replace(/[\\u0300-\\u036f]/g,'').replace(/['’`\\.\\-]/g,'').replace(/\\s+/g,'').trim(); }

    
    const PROD_TITLES = {
      "Gene Roddenberry": "Creator",
      "Lucille Ball": "Studio Head",
      "D.C. Fontana": "Writer/Producer",
      "Nicholas Meyer": "Director/Co-Writer",
      "Michael Piller": "Writer/Exec Producer",
      "Ira Steven Behr": "Exec Producer",
      "Jeri Taylor": "Writer/Producer",
      "Brannon Braga": "Writer/Exec Producer",
      "Ronald D. Moore": "Writer/Producer",
      "Rick Berman": "Exec Producer/Franchise Head",
      "Andre Bormanis": "Science Consultant/Writer",
      "Marc Okrand": "Linguist (Klingon)",
      "Michael Okuda": "Scenic/Graphic Designer",
      "Alex Kurtzman": "Co-Writer/Exec Producer"
    };

    const STUNT_TITLES = {
      "Paul Baxley": "Stunt Coordinator/Stunt Performer",
      "Bob Herron": "Stuntman/Stunt Double",
      "B. J. Davis": "Stunt Performer",
      "Chuck Borden": "Stunt Performer",
      "Dennis \"Danger\" Madalone": "Lead Stuntman",
      "Leslie Hoffman": "Stuntwoman/Stunt Double",
      "Tom Morga": "Stunt Performer/Stunt Double",
      "Leon \"Rusty\" McClennon": "Stunt Performer/Stunt Double",
      "William \"Bill\" Blackburn": "Stand-In/Background Extra",
      "Eddie Paskey": "Stand-In/Body Double",
      "David Keith Anderson": "Stand-In/Photo Double",
      "Guy Vardaman": "Stand-In"
    };
const SERIES = {
      TOS: [
        { name:"James T. Kirk",           role:"Captain",              actor:"William Shatner",               img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/James%20Kirk%20(TOS).png" },
        { name:"Spock",   role:"First Officer",        actor:"Leonard Nimoy",                 img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Spock%20(TOS).png" },
        { name:"Leonard (Bones) McCoy",   role:"Chief Medical Officer",               actor:"DeForest Kelley",               img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Doctor%20McCoy%20(TOS).png" },
        { name:"Montgomery Scott",        role:"Chief Engineer",       actor:"James Doohan",                  img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Scotty%20(TOS).png" },
        { name:"Nyota Uhura",             role:"Communications Officer",actor:"Nichelle Nichols",             img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Uhura%20(TOS).png" },
        { name:"Hikaru Sulu",             role:"Helmsman",             actor:"George Takei",                  img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Sulu%20(TOS).png" },
        { name:"Pavel Chekov",            role:"Navigator",            actor:"Walter Koenig",                 img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Chekov%20(TOS).png" },
        { name:"Yeoman Janice Rand",   role:"Captain's Yeoman",               actor:"Grace Lee Whitney",             img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Yeoman%20Rand%20(TOS).png" },
        { name:"Nurse Christine Chapel",   role:"Head Nurse",                actor:"Majel Barett Roddenberry",      img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Christine%20Chapel%20(TOS).png" }
      ],
      TNG: [
        { name:"Jean-Luc Picard",    role:"Captain",             actor:"Patrick Stewart",        img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Jean-Luc%20Picard%20(TNG).png" },
        { name:"William T. Riker",   role:"First Officer",       actor:"Jonathan Frakes",        img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/William%20T%20Riker%20(TNG).png" },
        { name:"Data",               role:"Operations",          actor:"Brent Spiner",           img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Data%20(TNG).png" },
        { name:"Reginald Barclay",   role:"Engineer",            actor:"Dwight Schultz",         img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Barclay%20(TNG).png" },
        { name:"Beverly Crusher",    role:"Chief Medical Officer", actor:"Gates McFadden",      img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Beverly%20Crusher%20(TNG).png" },
        { name:"Miles O'Brien",      role:"Transporter Chief",   actor:"Colm Meaney",            img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Chief%20O'Brien%20(TNG).png" },
        { name:"Guinan",             role:"Ten Forward Host",    actor:"Whoopi Goldberg",        img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Guinan%20(TNG).png" },
        { name:"Tasha Yar",          role:"Security Chief",      actor:"Denise Crosby",          img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Tasha%20Yar%20(TNG).png" },
        { name:"Deanna Troi",        role:"Counselor",           actor:"Marina Sirtis",          img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Troi%20(TNG).png" },
        { name:"Worf",               role:"Tactical/Security",   actor:"Michael Dorn",           img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Worf%20(TNG).png" }
      ],
      DS9: [
        { name:"Benjamin Sisko",     role:"Commander/Captain",   actor:"Avery Brooks",           img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Benjamin%20Sisko%20(DS9).png" },
        { name:"Kira Nerys",         role:"First Officer",       actor:"Nana Visitor",           img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Major%20Kira%20(DS9).png" },
        { name:"Worf",               role:"Strategic Ops",       actor:"Michael Dorn",           img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Worf%20(DS9).png" },
        { name:"Jadzia Dax",         role:"Science Officer",     actor:"Terry Farrell",          img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Jadzia%20Dax%20(DS9).png" },
        { name:"Dr. Julian Bashir",  role:"Chief Medical Officer", actor:"Alexander Siddig",   img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Doctor%20Bashir%20(DS9).png" },
        { name:"Miles O'Brien",      role:"Chief of Operations", actor:"Colm Meaney",            img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Chief%20O'Brien%20(DS9).png" },
        { name:"Odo",                role:"Security Chief",      actor:"Ren\u00e9 Auberjonois",  img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Odo%20(DS9).png" },
        { name:"Quark",              role:"Bartender",           actor:"Armin Shimerman",        img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Quark%20(DS9).png" }
      ],
      VOY: [
        { name:"Kathryn Janeway",    role:"Captain",             actor:"Kate Mulgrew",           img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Kathry%20Janeway%20(Voy).png" },
        { name:"Chakotay",           role:"First Officer",       actor:"Robert Beltran",         img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Chakotay%20(Voy).png" },
        { name:"Tuvok",              role:"Security/Tactical",   actor:"Tim Russ",               img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Tuvok%20(Voy).png" },
        { name:"Tom Paris",          role:"Helmsman",            actor:"Robert Duncan McNeill",  img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Tom%20Paris%20(VOY).png" },
        { name:"B'Elanna Torres",    role:"Chief Engineer",      actor:"Roxann Dawson",          img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/B'Elanna%20Torres%20(VOY).png" },
        { name:"Harry Kim",          role:"Operations",          actor:"Garrett Wang",           img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Harry%20Kim%20(VOY).png" },
        { name:"Seven of Nine",      role:"Astrometrics",        actor:"Jeri Ryan",              img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Seven%20of%20Nine%20(VOY).png" },
        { name:"The Doctor",         role:"Chief Medical Officer", actor:"Robert Picardo",      img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/The%20Doctor%20(VOY).png" },
        { name:"Neelix",             role:"Morale Officer",      actor:"Ethan Phillips",         img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Neelix%20(VOY).png" }
      ],
      ENT: [
        { name:"Jonathan Archer",    role:"Captain",             actor:"Scott Bakula",           img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Jonathan%20Archer%20(Ent).png" },
        { name:"Charles \"Trip\" Tucker III", role:"Chief Engineer", actor:"Connor Trinneer",   img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Trip%20Tucker%20(Ent).png" },
        { name:"T'Pol",             role:"Science Officer",      actor:"Jolene Blalock",         img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/TPol%20(Ent).png" },
        { name:"Malcolm Reed",      role:"Tactical Officer",     actor:"Dominic Keating",        img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Malcolm%20Reed.png" },
        { name:"Travis Mayweather", role:"Helmsman",             actor:"Anthony Montgomery",     img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Travis%20Mayweathere.png" },
        { name:"Hoshi Sato",        role:"Communications Officer", actor:"Linda Park",          img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Hoshi%20Sato.png" },
        { name:"Doctor Phlox",      role:"Chief Medical Officer", actor:"John Billingsley",     img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Doctor%20Phlox.png" }
      ],
DIS: [
        { name:"Michael Burnham",  role:"Captain, USS Discovery",          actor:"Sonequa Martin-Green", img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Default.png" },
        { name:"Saru",             role:"Kelpien Captain",                 actor:"Doug Jones",           img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Default.png" },
        { name:"Philippa Georgiou",role:"Captain, USS Shenzhou",          actor:"Michelle Yeoh",        img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Default.png" },
        { name:"Sylvia Tilly",     role:"Starfleet Officer & Instructor",  actor:"Mary Wiseman",         img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Default.png" },
        { name:"Hugh Culber",      role:"Chief Medical Officer",           actor:"Wilson Cruz",          img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Default.png" },
        { name:"Paul Stamets",     role:"Spore Drive Scientist",           actor:"Anthony Rapp",         img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Default.png" },
        { name:"Jett Reno",        role:"Engineer",                        actor:"Tig Notaro",           img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Default.png" },
        { name:"Adira Tal",        role:"Joined Specialist",               actor:"Blu del Barrio",       img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Default.png" },
        { name:"Joann Owosekun",   role:"Operations Officer",              actor:"Oyin Oladejo",         img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Default.png" },
        { name:"Keyla Detmer",     role:"Helm Officer",                    actor:"Emily Coutts",         img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Default.png" },
        { name:"Gabriel Lorca",    role:"Captain, USS Discovery",          actor:"Jason Isaacs",         img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Default.png" }
      ], PIC: [
        { name:"Deanna Troi",      role:"Counselor",        actor:"Marina Sirtis",      img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Troi%20(Pic).png" },
        { name:"Jean-Luc Picard",  role:"Retired Starfleet Admiral",        actor:"Patrick Stewart",    img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Picard%20(Pic).png" },
        { name:"Worf",             role:"Starfleet Intelligence",        actor:"Michael Dorn",       img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Worf%20(Pic).png" },
        { name:"William T. Riker", role:"Starfleet Veteran", actor:"Jonathan Frakes",    img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Riker%20(Pic).png" },
        { name:"Data",             role:"Soong-Type Android",        actor:"Brent Spiner",       img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Default.png" },
        { name:"Elnor",            role:"Qowat Milat Swordsman",        actor:"Evan Evagora",       img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Default.png" },
        { name:"Guinan",           role:"El-Aurian Listener",        actor:"Ito Aghayere",       img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Default.png" },
        { name:"Jack Crusher",     role:"Frontier Pilot",        actor:"Ed Speleers",        img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Default.png" },
        { name:"Beverly Crusher",  role:"Frontier Doctor", actor:"Gates McFadden",    img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Default.png" },
        { name:"Q",                role:"Omnipotent Influencer",        actor:"John de Lancie",     img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Default.png" },
        { name:"Seven of Nine",    role:"Fenris Ranger",        actor:"Jeri Ryan",          img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Default.png" },
        { name:"Soji Asha",        role:"Synthetic Advocate",        actor:"Isa Briones",        img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Default.png" },
        { name:"Vadic",            role:"Changeling Warlord",        actor:"Amanda Plummer",     img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Default.png" },
        { name:"Agnes Jurati",     role:"Cyberneticist / Borg Queen",        actor:"Alison Pill",        img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Default.png" },
        { name:"Cristóbal \"Chris\" Rios", role:"Captain of La Sirena", actor:"Santiago Cabrera",  img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Default.png" }
      ], GUEST: [
  { name:"Borg Queen", role:"Collective Leader", img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Borg%20Queen.png", actor:"Susanna Thompson" },
  { name:"Edith Keeler", role:"Social Worker", img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Default.png", actor:"Joan Collins" },
  { name:"Gary Seven", role:"Temporal Guardian", img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Default.png", actor:"Robert Lansing" },
  { name:"Q", role:"Omnipotent Influencer", img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Q.png", actor:"John De Lancie" },
  { name:"Roberta Lincoln", role:"Temporal Secretary", img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Default.png", actor:"Teri Garr" },
  { name:"Timicin", role:"Conflicted Scientist", img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Timicin.png", actor:"David Ogden Stiers" },
  { name:"Captain Morgan Bateson", role:"Time Traveler", img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Default.png", actor:"Kelsey Grammer" },
  { name:"General Martok", role:"Honorable Warrior", img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Default.png", actor:"J. G. Hertzler" },
  { name:"Harry Mudd", role:"Interstellar Con Man", img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Default.png", actor:"Roger C. Carmel" },
  { name:"Jett Reno", role:"Sarcastic Engineer", img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Default.png", actor:"Tig Notaro" },
  { name:"John Frederick Paxton", role:"Xenophobic Extremist", img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Default.png", actor:"Peter Weller" },
  { name:"Kai Winn Adami", role:"Religious Opportunist", img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Default.png", actor:"Louise Fletcher" },
  { name:"Kovich", role:"Enigmatic Operative", img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Default.png", actor:"David Cronenberg" },
  { name:"Kurn and Elder Jake Sisko", role:"Burdened Brothers", img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Default.png", actor:"Tony Todd" },
  { name:"Kurros", role:"Manipulative Genius", img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Default.png", actor:"Jason Alexander" },
  { name:"Pelia", role:"Eccentric Immortal", img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Default.png", actor:"Carol Kane" },
  { name:"Pendari Champion", role:"Seven's Challenger", img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Default.png", actor:"Dwayne \"The Rock\" Johnson" },
  { name:"Sarek", role:"Vulcan Ambassador", img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Default.png", actor:"Mark Lenard" },
  { name:"Weyoun, Brunt and Shran", role:"Multiple Faces", img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Default.png", actor:"Jeffrey Combs" }
], SNW: [
        { name:"Christopher Pike", role:"Captain", actor:"Anson Mount", img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Christopher%20Pike.png" },
        { name:"Una Chin Riley", role:"First Officer", actor:"Rebecca Romijn", img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Una%20Chin%20Riley.png" },
        { name:"Spock", role:"Science Officer", actor:"Ethan Peck", img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Spock%20(SNW).png" },
        { name:"Erica Ortegas", role:"Helm Officer", actor:"Melissa Navia", img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Erica%20Ortegas.png" },
        { name:"La'An Noonien-Singh", role:"Security Chief", actor:"Christina Chong", img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/La%E2%80%99An%20Noonien-Singh.png" },
        { name:"Nyota Uhura", role:"Communications", actor:"Celia Rose Gooding", img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Nyota%20Uhura.png" },
        { name:"Christine Chapel", role:"Nurse", actor:"Jess Bush", img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Christine%20Chapel.png" },
        { name:"Doctor M'Benga", role:"Chief Medical Officer", actor:"Babs Olusanmokun", img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Doctor%20M'Benga.png" }
      ],
      ARCS: [
        {
          name:"Borg Collective & Resistance",
          role:"Borg vs. Federation",
          actor:"Borg Story Arc",
          img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Borg%20Queen.png"
        },
        {
          name:"Q & the Trial of Humanity",
          role:"Q and the Captains",
          actor:"Q Story Arc",
          img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Q.png"
        },
        {
          name:"Khan & the Augment Legacy",
          role:"Genetic Engineering",
          actor:"Khan Story Arc",
          img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Khan%20Noonien%20Singh.png"
        },
        {
          name:"Synthetic Life & Personhood",
          role:"Androids, Holograms, Synths",
          actor:"Synthetic Life Arc",
          img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Data%20(TNG).png"
        },
        {
          name:"Founding of the Federation & Core Worlds",
          role:"Birth of the Federation",
          actor:"Founding Arc",
          img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Jonathan%20Archer%20(Ent).png"
        },
        {
          name:"Klingon–Federation Conflict & Alliance",
          role:"Warriors and Allies",
          actor:"Klingon–Federation Arc",
          img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Worf%20(TNG).png"
        },
        {
          name:"Dominion War & the Gamma Quadrant Powers",
          role:"Alpha Quadrant at War",
          actor:"Dominion War Arc",
          img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Benjamin%20Sisko%20(DS9).png"
        },
        {
          name:"Mirror Universe & the Terran Empire",
          role:"Terran Empire Reflections",
          actor:"Mirror Universe Arc",
          img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Major%20Kira%20(DS9).png"
        },
        {
          name:"Time Travel, Temporal Cold War & Temporal Law",
          role:"Temporal Paradoxes",
          actor:"Time Travel Arc",
          img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Jean-Luc%20Picard%20(TNG).png"
        },
        {
          name:"Section 31 & the Federation's Shadow",
          role:"Covert Federation Operations",
          actor:"Section 31 Arc",
          img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Doctor%20Bashir%20(DS9).png"
        }
      ]
    };    
    function resolveArc(arcs, title){
      if (!arcs || !Array.isArray(arcs)) return null;
      const t = (title || "").toLowerCase().trim();
      let arc = arcs.find(a => (a.title || "").toLowerCase() === t);
      if (!arc) {
        arc = arcs.find(a => (a.id || "").toLowerCase() === t.replace(/\s+/g, "_"));
      }
      return arc || null;
    }

    function sectionsFromArc(arc){
      if (!arc) return [{ header: "Story Arc", text: "Details not found." }];
      const out = [];
      if (arc.overview) {
        out.push({ header: "Overview", text: arc.overview });
      }
      if (Array.isArray(arc.chapters)) {
        arc.chapters.forEach((ch) => {
          out.push({ header: ch.title || "", text: ch.body || "" });
        });
      }
      if (Array.isArray(arc.key_themes) && arc.key_themes.length) {
        out.push({ header: "Key Themes", text: arc.key_themes.join("; ") });
      }
      if (arc.key_characters && Array.isArray(arc.key_characters.crew) && arc.key_characters.crew.length) {
        const crewLinks = arc.key_characters.crew.map((name) => {
          const safe = esc(name);
          return `<a href="#" data-related-bio="crew" data-name="${safe}">${safe}</a>`;
        }).join(" • ");
        out.push({ header: "Related Crew", html: crewLinks });
      }
      if (arc.key_characters && Array.isArray(arc.key_characters.actors) && arc.key_characters.actors.length) {
        const actorLinks = arc.key_characters.actors.map((name) => {
          const safe = esc(name);
          return `<a href="#" data-related-bio="actor" data-name="${safe}">${safe}</a>`;
        }).join(" • ");
        out.push({ header: "Related Actors", html: actorLinks });
      }
      return out;
    }

    const ALIASES = {
      TOS: {
        crew: {
          "James T. Kirk":"James T Kirk",
          "Leonard (Bones) McCoy":"Doctor McCoy",
          "Nyota Uhura":"Uhura",
          "Hikaru Sulu":"Sulu",
          "Pavel Chekov":"Chekov",
          "Yeoman Janice Rand":"Yeoman Rand",
          "Nurse Christine Chapel":"Nurse Chapel",
          "Montgomery Scott":"Scotty"
        },
        actor: {
          "Majel Barett Roddenberry":"Majel Barett Roddenberry",
          "Majel Barrett":"Majel Barett Roddenberry",
          "Majel-Barett Roddenberry":"Majel Barett Roddenberry"
        }
      },
      DS9: {
        crew: {
          "Lt. Commander Worf":"Worf",
          "Elim Garak":"Garak"
        },
        actor: {}
      },
      TNG: {
        crew: {
          "William T. Riker":"William Riker",
          "Reginald Barclay":"Barclay",
          "Miles O'Brien":"Miles O'Brien",
          "Lt. Commander Worf":"Worf",
          "Chief O'Brien":"Miles O'Brien"
        },
        actor: {}
      },
      ENT: {
        crew: {
          "Doctor Phlox":"Phlox",
          "Dr. Phlox":"Phlox",
          "Dr Phlox":"Phlox",
          "Charles \"Trip\" Tucker III":"Charles \"Trip\" Tucker III",
          "Trip Tucker":"Charles \"Trip\" Tucker III"
        },
        actor: {}
      },
      SNW: {
        crew: {
          "Una Chin Riley":"Una Chin-Riley",
          "Una":"Una Chin-Riley",
          "Number One":"Una Chin-Riley",
          "Doctor M'Benga":"Dr. Joseph M'Benga",
          "Dr. M'Benga":"Dr. Joseph M'Benga",
          "M'Benga":"Dr. Joseph M'Benga"
        },
        actor: {}
      },
      PIC: {
        crew: {},
        actor: {}
      }
};

    async function fetchJSON(url) {
      const r = await fetch(url, { cache: "no-store" });
      if (!r.ok) throw new Error("" + r.status);
      const d = await r.json();
      return (d && d.bios) ? d.bios : d;
    }

    async function loadTOS() {
      return fetchJSON("https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Biographies/Bios-TOS.json");
    }

    async function loadDS9() {
      return fetchJSON("https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Biographies/Bios-DS9.json");
    }

    async function loadTNG() {
      return fetchJSON("https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Biographies/Bios-TNG.json");
    }

    async function loadENT() {
      return fetchJSON("https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Biographies/Bios-ENT.json");
    }

    async function loadSNW() {
      return fetchJSON("https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Biographies/Bios-SNW.json");
    }

    async function loadPIC() {
      return fetchJSON("https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Biographies/Bios-PIC.json");
    }

    async function loadVOY() {
      return fetchJSON("https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Biographies/Bios-VOY.json");
    }

    async function loadDIS() {
      return fetchJSON("https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Biographies/Bios-DIS.json");
    }

        async function loadProdStunts() {
      if (cachedProdStunts) return cachedProdStunts;
      const data = await fetchJSON(PROD_STUNTS_URL);
      cachedProdStunts = data || {};
      return cachedProdStunts;
    }

async function loadARCS() {
      try {
        const tag = document.getElementById("arcs-json");
        if (tag && tag.textContent) {
          const d = JSON.parse(tag.textContent);
          const arcs = d && d.arcs ? d.arcs : [];
          console.log("Story Arcs: loaded from embedded JSON", arcs.length);
          if (arcs.length) return arcs;
        }
      } catch (e) {
        console.log("Story Arcs: error parsing embedded JSON", e);
      }
      console.log("Story Arcs: fetching from URL");
      const d = await fetchJSON("https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Story%20Arcs/Story%20Arcs.json");
      const arcs = d && d.arcs ? d.arcs : [];
      console.log("Story Arcs: fetched from URL", arcs.length);
      return arcs;
    }

    async function loadEPISODES(mode) {
      const which = (mode || currentEpisodeMode || "best");
      const cached = which === "worst" ? cachedEpisodesWorst : cachedEpisodesBest;
      if (cached && Array.isArray(cached)) {
        return cached;
      }
      try {
        const url = which === "worst"
          ? "https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Episode%20Guide/Curated%20Episodes%20-%20Worst.json"
          : "https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Episode%20Guide/Curated%20Episodes.json";
        console.log("Curated Episodes (" + which + "): fetching from URL");
        const d = await fetchJSON(url);
        const episodes = d && Array.isArray(d.episodes) ? d.episodes : (Array.isArray(d) ? d : []);
        console.log("Curated Episodes (" + which + "): fetched from URL", episodes.length);
        if (which === "worst") cachedEpisodesWorst = episodes;
        else cachedEpisodesBest = episodes;
        return episodes;
      } catch (e) {
        console.error("Curated Episodes (" + which + "): error fetching", e);
        return [];
      }
    }


    function buildEpisodeCards(episodes) {
      if (!Array.isArray(episodes)) return [];
      const episodeImgMap = {
        "The City on the Edge of Forever": "https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Episode%20Guide/TOS%20Episode%20(The%20City%20on%20the%20Edge%20of%20Forever).png",
        "Space Seed": "https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Episode%20Guide/TOS%20Episode%20(Space%20Seed).png",
        "The Inner Light": "https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Episode%20Guide/TNG%20Episode%20(The%20Inner%20Light).png",
        "Chain of Command": "https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Episode%20Guide/TNG%20Episode%20(Chain%20of%20Command).png",
        "Chain of Command, Parts I–II": "https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Episode%20Guide/TNG%20Episode%20(Chain%20of%20Command).png",
        "The Visitor": "https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Episode%20Guide/DS9%20Episode%20(The%20Visitor).png",
        "Far Beyond the Stars": "https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Episode%20Guide/DS9%20Episode%20(Far%20Beyond%20the%20Stars).png",
        "Scorpion": "https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Episode%20Guide/VOY%20Episode%20(Scorpion).png",
        "Scorpion, Parts I–II": "https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Episode%20Guide/VOY%20Episode%20(Scorpion).png",
        "Living Witness": "https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Episode%20Guide/VOY%20Episode%20(Living%20Witness).png",
        "Dear Doctor": "https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Episode%20Guide/ENT%20Episode%20(Dear%20Doctor).png",
        "Carbon Creek": "https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Episode%20Guide/ENT%20Episode%20(Carbon%20Creek).png",
        "Strange New Worlds": "https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Episode%20Guide/SNW%20Episode%20(Strange%20New%20Worlds).png",
        "Tomorrow and Tomorrow and Tomorrow": "https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Episode%20Guide/SNW%20Episode%20(Tomorrow%2C%20and%20Tomorrow%20and%20Tomorrow).png",
        "Tomorrow, and Tomorrow and Tomorrow": "https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Episode%20Guide/SNW%20Episode%20(Tomorrow%2C%20and%20Tomorrow%20and%20Tomorrow).png",
        "Magic to Make the Sanest Man Go Mad": "https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Episode%20Guide/DIS%20Episode%20(Magic%20to%20Make%20the%20Sanest%20Man%20Go%20Mad).png",
        "An Obol for Charon": "https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Episode%20Guide/DIS%20Episode%20(An%20Obol%20for%20Charon).png",
        "Nepenthe": "https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Episode%20Guide/PIC%20Episode%20(Nepenthe).png",
        "No Win Scenario": "https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Episode%20Guide/PIC%20Episode%20(No%20Win%20Scenario).png"
      };
      return episodes.map((ep) => {
        const series = ep.series || "";
        const season = ep.season;
        const nums = Array.isArray(ep.episodes) ? ep.episodes.slice().sort((a, b) => a - b) : [];
        let epPart = "";
        if (season && nums.length) {
          const first = nums[0];
          const last = nums[nums.length - 1];
          if (first === last) epPart = "Season " + season + ", Episode " + first;
          else epPart = "Season " + season + ", Episodes " + first + "–" + last;
        } else if (season) {
          epPart = "Season " + season;
        }
        const rolePieces = [];
        if (series) rolePieces.push(series);
        if (epPart) rolePieces.push(epPart);
        const role = rolePieces.join(" • ") || "Curated Episode";
        const title = ep.title || "";
        const img = episodeImgMap[title] || "https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Default.png";
        return {
          name: title,
          role,
          actor: "Curated Episode",
          img
        };
      });
    }

    function mapDs9Alias(n) {
      return n;
    }

    async function loadGUEST() {
      try {
        const tag = document.getElementById("guests-json");
        if (tag && tag.textContent) {
          const parsed = JSON.parse(tag.textContent);
          return (parsed && parsed.bios) ? parsed.bios : parsed;
        }
      } catch (e) {
      }
      const r = await fetch("https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Biographies/Bios-Guests.json", { cache: "no-store" });
      if (!r.ok) throw new Error("" + r.status);
      const d = await r.json();
      return (d && d.bios) ? d.bios : d;
    }

    function resolve(ds, name, which, seriesKey){
      const display = (name||'').trim();

      const seriesAliases = (ALIASES[seriesKey] && ALIASES[seriesKey][which]) || {};
      const aliased = seriesAliases[display] || display;

      const cset = new Set();
      const straight = aliased.replace(/[’`]/g, "'");
      const curly   = straight.replace(/'/g, "’");
      const noHyphen = straight.replace(/-/g, " ");
      const withHyphen = straight.replace(/\s+/g, " ").replace(/\b([A-Za-z])\s*-\s*([A-Za-z])/g, "$1-$2");
      const baseVariants = new Set([straight, curly, noHyphen, withHyphen]);
      baseVariants.forEach(v => {
        cset.add(v);
        cset.add(v.replace(/^Doctor\s+/i, "Dr. "));
        cset.add(v.replace(/^Dr\.\s+/i, "Doctor "));
        cset.add(v.replace(/^Dr\s+/i, "Dr. "));
      });
      const candidates = Array.from(cset);

      const dicts = which==='actor' ? [ds?.Actors, ds?.actors, ds?.actorBios, ds] : [ds?.Crew, ds?.crew, ds?.characters, ds];

      for (const cand of candidates){
        for (const d of dicts){ if (d && d[cand]) return d[cand]; }
      }

      const norm = (s)=> String(s||'').toLowerCase().normalize('NFKD').replace(/[\u0300-\u036f]/g,'').replace(/['’`\.\-]/g,'').replace(/\s+/g,'').trim();
      for (const d of dicts){
        if (!d) continue;
        const keys = Object.keys(d);
        for (const k of keys){
          const nk = norm(k);
          for (const cand of candidates){
            if (norm(cand) === nk) return d[k];
          }
        }
      }
      return null;
    }

    function setTitles(key){
      if (titleEl)   titleEl.textContent = "Star Trek";
      if (subtitleEl) {
        let subtitleText = "";
        if (key === 'EPISODES') {
          subtitleText = (currentEpisodeMode === "worst")
            ? "Hall of Shame (Episodes)"
            : "Hall of Fame (Episodes)";
        } else {
          subtitleText =
            key==='TOS' ? "The Original Series" :
            key==='TNG' ? "The Next Generation" :
            key==='DS9' ? "Deep Space Nine" :
            key==='VOY' ? "Voyager" :
            key==='ENT' ? "Enterprise" :
            key==='DIS' ? "Discovery" :
            key==='PIC' ? "Picard" :
            key==='SNW' ? "Strange New Worlds" :
            key==='ARCS' ? "Story Arcs" :
            key==='GUEST' ? "Guest List" :
            key==='PROD' ? "Production & Behind-the-Scenes" :
            key==='STUNTS' ? "Stunts & Stand-Ins" : "";
        }
        subtitleEl.textContent = subtitleText;
      }
    }
    function showCards(){
      seriesMenu.style.display = "none";
      cardsGrid.style.display  = "flex";
      returnMenu.style.display = "inline-flex";
      if (headerNavLeft) headerNavLeft.style.display = "none";
      if (headerNavRight) headerNavRight.style.display = "none";
      document.documentElement.classList.toggle("series-non-tos", subtitleEl.textContent !== "The Original Series");
      window.scrollTo({top:0, behavior:"instant"});
    }
    function clearTopThree(){
      const host = $(".cards-row");
      if (host) {
        host.innerHTML = "";
      }
    }
    function setTopThree(people){
    }
    function clearExtras(){
    }
    function renderExtras(people, key){
      const host = $(".cards-row");
      if (!host) return;
      host.innerHTML = "";
      const list = Array.isArray(people) ? people : [];
      list.forEach((p) => {
        const card = document.createElement("article");
        card.className = "character-card series-dynamic";
        if (key && typeof key === "string") {
          card.className += " " + key.toLowerCase() + "-only";
        }
        const text = document.createElement("div");
        text.className = "card-text";
        const name  = p && p.name  ? p.name  : "";
        const role  = p && p.role  ? p.role  : "";
        const actor = p && p.actor ? p.actor : "";
        text.innerHTML = `
          <a href="#" class="character-name">${name}</a>
          <p class="character-title">${role}</p>
          <a href="#" class="character-actor">${actor}</a>`;
        card.appendChild(text);
        host.appendChild(card);
      });
    }

    function labelToKey(label){
      const l=(label||"").toLowerCase();
      if (l.includes("original")) return "TOS";
      if (l.includes("next generation") || l.includes("tng")) return "TNG";
      if (l.includes("deep space nine") || l.includes("ds9")) return "DS9";
      if (l.includes("voyager") || l.includes("voy")) return "VOY";
      if (l.includes("enterprise") || l.includes("ent")) return "ENT";
      if (l.includes("discovery") || l.includes("dis")) return "DIS";
      if (l.includes("picard") || l.includes("pic")) return "PIC";
      if (l.includes("strange new worlds") || l.includes("snw")) return "SNW";
      if (l.includes("best episodes") || l.includes("worst episodes") || l.includes("curated episode") || l.includes("episode guide") || l.includes("hall of fame") || l.includes("hall of shame")) return "EPISODES";
      if (l.includes("story arcs") || l.includes("story arc") || l.includes("arcs")) return "ARCS";
      if (l.includes("guest")) return "GUEST";
      return "";
    }

        async function showProduction() {
      currentSeriesKey = "PROD";
      setTitles("PROD");
      showCards();
      clearTopThree();
      clearExtras();
      try {
        const data = await loadProdStunts();
        const section = (data && data.Production) ? data.Production : {};
        const names = Object.keys(section).sort((a, b) => a.localeCompare(b));
        const people = names.map((name) => ({
          name,
          role: PROD_TITLES[name] || "Production",
          actor: "",
          img: "https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Default.png"
        }));
        setTopThree(people);
        renderExtras(people, "PROD");
      } catch (e) {
        console.error("Production load error", e);
        setTopThree([]);
        renderExtras([], "PROD");
      }
    }


    async function showStunts() {
      currentSeriesKey = "STUNTS";
      setTitles("STUNTS");
      showCards();
      clearTopThree();
      clearExtras();
      try {
        const data = await loadProdStunts();
        const section = (data && data.Stunts) ? data.Stunts : {};
        const names = Object.keys(section).sort((a, b) => a.localeCompare(b));
        const people = names.map((name) => ({
          name,
          role: STUNT_TITLES[name] || "Stunts & Stand-Ins",
          actor: "",
          img: "https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Default.png"
        }));
        setTopThree(people);
        renderExtras(people, "STUNTS");
      } catch (e) {
        console.error("Stunts load error", e);
        setTopThree([]);
        renderExtras([], "STUNTS");
      }
    }


function applySeries(key){

      currentSeriesKey = key;
      setTitles(key);

      showCards();
      clearTopThree();
      clearExtras();

      const isTOS = key === "TOS";
      $$(".character-card.tos-only").forEach(c => c.style.display = isTOS ? "flex" : "none");

      if (key === "EPISODES") {
        loadEPISODES().then((episodes) => {
          const list = Array.isArray(episodes) ? episodes : [];
          const people = buildEpisodeCards(list);
          setTopThree(people);
          renderExtras(people, key);
        }).catch((err) => {
          console.error("Curated Episodes load error", err);
          setTopThree([]);
          renderExtras([], key);
        });
        return;
      }

      const people = SERIES[key] || [];
      setTopThree(people);
      renderExtras(people, key);
      if (key === "SNW") {
        const cards = document.querySelectorAll(".cards-row .character-card");
        cards.forEach(async (card) => {
          const nameEl = card.querySelector(".character-name");
          const imgEl  = card.querySelector("img");
          if (!nameEl || !imgEl) return;

          const isPlaceholder = (imgEl.src || "").startsWith("data:image/svg+xml");
          if (!isPlaceholder) return;
          const n = nameEl.textContent.trim();
          const found = await findSnwImage(n);
          if (found) { imgEl.src = found; }
        });
      }
    }

    
    function renderBio(title, sections, imgUrl){
      const fallbackImg = imgUrl || 'https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Default.png';
      const blocks = Array.isArray(sections) ? sections : [{header:"Biography", text:"No biography available."}];
      const seriesSubtitle = (subtitleEl && subtitleEl.textContent) ? subtitleEl.textContent.toLowerCase() : "";
      const isEpisodes = seriesSubtitle.includes("hall of fame") || seriesSubtitle.includes("hall of shame") || seriesSubtitle.includes("episode");
      const isArc = !isEpisodes && Array.isArray(blocks) && blocks.length && blocks[0].header === "Overview";

            const isProd = seriesSubtitle.includes("production") || seriesSubtitle.includes("behind-the-scenes") || seriesSubtitle.includes("behind the scenes") || seriesSubtitle.includes("behind the camera");
      const isStunts = seriesSubtitle.includes("stunts") || seriesSubtitle.includes("stand-ins") || seriesSubtitle.includes("stand in");
      const isProdStunts = isProd || isStunts;
      const hasToggle = !isArc && !isEpisodes && !isProdStunts && !!(bioLinkState && bioLinkState.crewEl && bioLinkState.actorEl);
      const which = bioLinkState && bioLinkState.which === "actor" ? "actor" : "crew";
      const toggleLabel = hasToggle
        ? (which === "crew" ? "View Actor Biography" : "View Character Biography")
        : "";
      const subtitle = isArc
        ? "Story Arc"
        : (isEpisodes
          ? (currentEpisodeMode === "worst" ? "Hall of Shame" : "Hall of Fame")
          : (isProd
            ? "Production Crew"
            : (isStunts
              ? "Stunts/Stand-Ins"
              : (which === "crew" ? "Character Biography" : "Actor Biography"))));

      const headerHtml = `
        <div class="bio-overlay-inner">
          <header class="bio-overlay-header">
            <div class="bio-overlay-title">
              <div class="bio-overlay-title-main">${esc(title)}</div>
              <div class="bio-overlay-title-sub">${subtitle}</div>
            </div>
          </header>
      `;

      const crewEl = bioLinkState && bioLinkState.crewEl ? bioLinkState.crewEl : null;
      const actorEl = bioLinkState && bioLinkState.actorEl ? bioLinkState.actorEl : null;
      const roleEl = crewEl && crewEl.parentElement
        ? crewEl.parentElement.querySelector(".character-title")
        : null;

      const crewName = crewEl ? crewEl.textContent.trim() : title;
      const actorName = actorEl ? actorEl.textContent.trim() : "";
      const roleText = roleEl
        ? roleEl.textContent.trim()
        : (isArc
          ? "Story Arc"
          : (isEpisodes
            ? (currentEpisodeMode === "worst" ? "Hall of Shame" : "Hall of Fame")
            : subtitle));

      const topIsActor = which === "actor";

      const topName = topIsActor ? (actorName || crewName) : crewName;
      const bottomName = topIsActor ? crewName : actorName;

      const nameHtml = topName
        ? `<div class="badge-2-name">${esc(topName)}</div>`
        : "";
      const roleHtml = roleText
        ? `<div class="badge-2-role">${esc(roleText)}</div>`
        : "";
      const actorHtml = bottomName
        ? `<div class="badge-2-actor">${esc(bottomName)}</div>`
        : "";

      const imageHtml = [
            `<div class="bio-image-col">`,
            `<div class="badge-2">`,
            `<div class="badge-2-text">`,
            nameHtml,
            roleHtml,
            actorHtml,
            `</div>`,
            `</div>`,
            `</div>`
          ].join("");

      const bodyHtml = blocks.map((s) => {
        const header = esc(s.header || "");
        const body = s.html ? s.html : esc(s.text || "");
        return [
          `<h3 style="color:gold;font-weight:bold;font-family:Orbitron, 'Eurostile', system-ui, sans-serif;font-size:1.05rem;margin:1.1rem auto 0.35rem;max-width:85%;">${header}</h3>`,
          `<p style="color:#e3f1ff;line-height:1.55;font-size:calc(0.95rem + 2pt);max-width:85%;margin:0.35rem auto 0;">${body}</p>`
        ].join("");
      }).join("");

      const contentHtml = `
          <main class="bio-overlay-main">
            ${imageHtml}
            <div class="bio-text-col">
              ${bodyHtml}
            </div>
          </main>
      `;

      const buttonsHtml = [
        hasToggle
          ? `<button type="button" id="toggleBioView" style="margin-right:0.75rem;padding:0.4rem 1.2rem;border-radius:999px;border:1px solid rgba(255,255,255,0.6);background:rgba(4,20,40,0.9);color:#e3f1ff;font-family:Orbitron,sans-serif;font-size:0.8rem;letter-spacing:0.08em;text-transform:uppercase;cursor:pointer;box-shadow:0 0 6px rgba(0,0,0,0.7);">${esc(toggleLabel)}</button>`
          : "",
        `<button type="button" id="returnToCrew" style="padding:0.4rem 1.4rem;border-radius:999px;border:1px solid rgba(255,255,255,0.8);background:linear-gradient(135deg,#0b2a3f,#04101d);color:#e3f1ff;font-family:Orbitron,sans-serif;font-size:0.8rem;letter-spacing:0.08em;text-transform:uppercase;cursor:pointer;box-shadow:0 0 10px rgba(0,0,0,0.85);">Return to Crew</button>`
      ].join("");

      const footerHtml = `
          <footer class="bio-overlay-footer">
            ${buttonsHtml}
          </footer>
        </div>
      `;

      bioOverlay.innerHTML = headerHtml + contentHtml + footerHtml;
      bioOverlay.style.display = "block";
      cardsGrid.style.display = "none";
      returnMenu.style.display = "inline-flex";
      if (headerShip) headerShip.style.display = "block";
      document.body.classList.add("bio-open");
      window.scrollTo({ top: 0, behavior: "instant" });
    }

function hideBio(){
      bioOverlay.style.display = "none";
      bioOverlay.innerHTML = "";
      cardsGrid.style.display = "flex";
      returnMenu.style.display = "inline-flex";
      if (headerShip) headerShip.style.display = "none";
      document.body.classList.remove("bio-open");
      window.scrollTo({top:0, behavior:"instant"});
    }

    document.addEventListener("click", async (e) => {

      const btn = e.target.closest(".series-btn");
      if (btn && btn.hasAttribute("data-series")) {
        e.preventDefault();
        const rawLabel = btn.getAttribute("data-series") || btn.textContent || "";
        const seriesLabel = rawLabel.toLowerCase();

        if (seriesLabel.includes("stunts") || seriesLabel.includes("stand-ins") || seriesLabel.includes("stand ins")) {
          await showStunts();
          return;
        }

        if (seriesLabel.includes("behind the camera")) {
          await showProduction();
          return;
        }

        if (seriesLabel.includes("best episodes")) {
          currentEpisodeMode = "best";
        } else if (seriesLabel.includes("worst episodes")) {
          currentEpisodeMode = "worst";
        }
        applySeries(labelToKey(rawLabel));
        return;
      }

      if (e.target.closest("#return-menu")) {
        e.preventDefault();
        bioOverlay.style.display = "none";
        document.documentElement.classList.remove("series-non-tos");
        if (headerShip) headerShip.style.display = "none";

        titleEl.textContent = "Bio Trek";
        subtitleEl.textContent = "Star Trek Biographies";

        seriesMenu.style.display = "flex";
        cardsGrid.style.display = "none";
        returnMenu.style.display = "none";

        if (headerNavLeft) headerNavLeft.style.display = "inline-flex";
        if (headerNavRight) headerNavRight.style.display = "inline-flex";

        return;
      }

      if (e.target && e.target.id === "toggleBioView") {
        e.preventDefault();
        if (bioLinkState) {
          const target = bioLinkState.which === "crew"
            ? bioLinkState.actorEl
            : bioLinkState.crewEl;
          if (target) {
            target.click();
          }
        }
        return;
      }

      if (e.target && e.target.id === "returnToCrew") {
        e.preventDefault();
        hideBio();
        return;
      }

      const nameLink  = e.target.closest("a.character-name");
      const actorLink = e.target.closest("a.character-actor");
      if (!nameLink && !actorLink) return;
      e.preventDefault();

      const series = (subtitleEl.textContent || "").toLowerCase();
      const isTOS  = series.includes("original");
      const isDS9  = series.includes("deep space nine");
      const isTNG  = series.includes("next generation") || series.includes("tng");
      const isENT  = series.includes("enterprise") || series.includes("ent");
      const isVOY  = series.includes("voyager") || series.includes("voy");
      const isDIS  = series.includes("discovery") || series.includes("dis ");
      const isSNW  = series.includes("strange new worlds") || series.includes("snw");
      const isPIC  = series.includes("picard") || series.includes("pic");
      const isGUEST = series.includes("guest");
      const isPROD = series.includes("production") || series.includes("behind the") || series.includes("behind-the-scenes") || series.includes("behind the camera");
      const isSTUNTS = series.includes("stunts") || series.includes("stand-ins") || series.includes("stand in");
      const isARCS = series.includes("story arcs");
      const isEPISODES = series.includes("curated episode") || series.includes("episode guide") || series.includes("hall of fame") || series.includes("hall of shame") || series.includes("episodes");
      const isOther = !(isTOS || isDS9 || isTNG || isENT || isVOY || isDIS || isSNW || isPIC || isGUEST || isARCS || isEPISODES || isPROD || isSTUNTS);
      if (isARCS && nameLink) {
        return;
      }
      try {
        const which = nameLink ? "crew" : "actor";
        const text  = (nameLink ? nameLink : actorLink).textContent;
        const linkEl = nameLink ? nameLink : actorLink;
        const cardEl = linkEl.closest(".character-card");
        const imgEl = cardEl ? cardEl.querySelector("img") : null;
        const imgUrl = imgEl ? imgEl.src : "";
        const crewEl = cardEl ? cardEl.querySelector("a.character-name") : null;
        const actorEl = cardEl ? cardEl.querySelector("a.character-actor") : null;
        bioLinkState = { which, crewEl, actorEl };
        if (isEPISODES) {
          const episodes = await loadEPISODES();
          const titleElWithinCard = cardEl ? cardEl.querySelector("a.character-name") : null;
          const titleText = titleElWithinCard ? titleElWithinCard.textContent : text;
          const episode = resolveArc(episodes, titleText);
          const sections = sectionsFromArc(episode);
          console.log("Curated Episodes: click", { clicked:titleText, hasEpisode:!!episode, sections:sections.length });
          bioLinkState = null;
          renderBio(episode ? episode.title : titleText, sections, imgUrl);
        } else if (isARCS) {
          const arcs = await loadARCS();
          const titleElWithinCard = cardEl ? cardEl.querySelector("a.character-name") : null;
          const titleText = titleElWithinCard ? titleElWithinCard.textContent : text;
          const arc = resolveArc(arcs, titleText);
          const sections = sectionsFromArc(arc);
          console.log("Story Arcs: click", { clicked:text, resolved:titleText, hasArc:!!arc, sections:sections.length });
          bioLinkState = null;
          renderBio(arc ? arc.title : titleText, sections, imgUrl);
        } else if (isTOS) {
          const ds = await loadTOS();
          const sections = resolve(ds, text, which, "TOS") || [{header:"Biography", text:"Not found."}];
          renderBio(text, sections, imgUrl);
        } else if (isDS9) {
          const ds = await loadDS9();
          const sections = resolve(ds, text, which, "DS9") || [{header:"Biography", text:"Not found."}];
          renderBio(text, sections, imgUrl);
        } else if (isTNG) {
          const ds = await loadTNG();
          const sections = resolve(ds, text, which, "TNG") || [{header:"Biography", text:"Not found."}];
          renderBio(text, sections, imgUrl);
        } else if (isENT) {
          const ds = await loadENT();
          const sections = resolve(ds, text, which, "ENT") || [{header:"Biography", text:"Not found."}];
          renderBio(text, sections, imgUrl);
        } else if (isVOY) {
          const ds = await loadVOY();
          const sections = resolve(ds, text, which, "VOY") || [{header:"Biography", text:"Not found."}];
          renderBio(text, sections, imgUrl);
        } else if (isDIS) {
          const ds = await loadDIS();
          const sections = resolve(ds, text, which, "DIS") || [{header:"Biography", text:"Not found."}];
          renderBio(text, sections, imgUrl);
        } else if (isSNW) {
          const ds = await loadSNW();
          const sections = resolve(ds, text, which, "SNW") || [{header:"Biography", text:"Not found."}];
          renderBio(text, sections, imgUrl);
        } else if (isPIC) {
          const ds = await loadPIC();
          const sections = resolve(ds, text, which, "PIC") || [{header:"Biography", text:"Not found."}];
          renderBio(text, sections, imgUrl);
        } else if (isGUEST) {
          const ds = await loadGUEST();
          const sections = resolve(ds, text, which, "GUEST") || [{header:"Biography", text:"Not found."}];
          renderBio(text, sections, imgUrl);
        } else if (isPROD) {
          const data = await loadProdStunts();
          const section = data && data.Production ? data.Production[text] : null;
          const sections = Array.isArray(section) ? section : [{header:"Biography", text:"Not found."}];
          renderBio(text, sections, imgUrl);
        } else if (isSTUNTS) {
          const data = await loadProdStunts();
          const section = data && data.Stunts ? data.Stunts[text] : null;
          const sections = Array.isArray(section) ? section : [{header:"Biography", text:"Not found."}];
          renderBio(text, sections, imgUrl);
        } else {
          renderBio(text, [{header:"Biography", text:"This series is not wired to bios yet."}], imgUrl);
        }
      }

catch (err) {
        renderBio("Error", [{header:"Biography", text:"Failed to load biography data."}], imgUrl);
      }
    });
  
    

    document.addEventListener("click", async (e) => {
      const rel = e.target.closest && e.target.closest("[data-related-bio]");
      if (!rel) return;
      e.preventDefault();
      const name = rel.getAttribute("data-name") || "";
      const type = rel.getAttribute("data-related-bio") || "crew";
      const which = type === "actor" ? "actor" : "crew";
      const imgUrl = "";
      try {
        const seriesKeys = ["TOS","TNG","DS9","VOY","ENT","DIS","SNW","PIC","GUEST"];
        for (const key of seriesKeys) {
          let ds = null;
          if (key === "TOS") ds = await loadTOS();
          else if (key === "TNG") ds = await loadTNG();
          else if (key === "DS9") ds = await loadDS9();
          else if (key === "VOY") ds = await loadVOY();
          else if (key === "ENT") ds = await loadENT();
          else if (key === "DIS") ds = await loadDIS();
          else if (key === "SNW") ds = await loadSNW();
          else if (key === "PIC") ds = await loadPIC();
          else if (key === "GUEST") ds = await loadGUEST();
          if (!ds) continue;
          const section = resolve(ds, name, which, key);
          if (section) {
            bioLinkState = { which, crewEl: null, actorEl: null };
            renderBio(name, section, imgUrl);
            return;
          }
        }
        renderBio(name, [{ header: "Biography", text: "Biography not found in the current data files." }], imgUrl);
      } catch (err) {
        console.error("Related bio error", err);
        renderBio(name, [{ header: "Biography", text: "Biography could not be loaded." }], imgUrl);
      }
    });

    document.addEventListener("click", (e) => {
      const a = e.target.closest && e.target.closest("a");
      if (!a) return;
      if (a.classList && (a.classList.contains("character-name") || a.classList.contains("character-actor"))) {

      }
    }, true);
  

    
    function positionStoryArcsRow() {
      const grid = document.querySelector(".series-grid");
      if (!grid) return;
      const rows = grid.querySelectorAll(".button-row");
      if (rows.length < 6) return;

      const aboveRow = rows[3];
      const arcsRow = rows[4];
      const fameRow = rows[5];

      arcsRow.style.marginTop = "";

      const aboveRect = aboveRow.getBoundingClientRect();
      const fameRect = fameRow.getBoundingClientRect();
      const arcsRect = arcsRow.getBoundingClientRect();

      const gap = fameRect.top - aboveRect.bottom;
      if (gap <= 0) return;

      const targetTop = aboveRect.bottom + gap / 2 - arcsRect.height / 2;
      const currentTop = arcsRect.top;
      const computedMargin = parseFloat(window.getComputedStyle(arcsRow).marginTop) || 0;
      const neededMargin = computedMargin + (targetTop - currentTop);

      arcsRow.style.marginTop = neededMargin + "px";
    }

        if (headerNavLeft) {
      headerNavLeft.addEventListener("click", (e) => {
        e.preventDefault();
        showStunts();
      });
    }
    if (headerNavRight) {
      headerNavRight.addEventListener("click", (e) => {
        e.preventDefault();
        showProduction();
      });
    }

    if (headerNavLeft) headerNavLeft.style.display = "inline-flex";
    if (headerNavRight) headerNavRight.style.display = "inline-flex";

positionStoryArcsRow();
    window.addEventListener("resize", positionStoryArcsRow);

display = "inline-flex";

positionStoryArcsRow();
    window.addEventListener("resize", positionStoryArcsRow);

</script>
