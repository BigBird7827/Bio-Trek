<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Bio-Trek</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap" rel="stylesheet"/>
  <style>
    :root { --card-img-h: 240px; }

    html, body {
      margin: 0; padding: 0; min-height: 100vh;
      display: flex; flex-direction: column;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background-color: #02061d; color: #f5f5f5;
    }
    header { padding: 1rem 1rem 0.5rem; text-align: center; }
    main   { flex: 1; display: flex; justify-content: center; padding: 1.5rem 1rem 2.5rem; }
    .series-wrapper { width: 100%; max-width: 1400px; }

    .title-main   { font-family: "Orbitron", sans-serif; font-size: 42pt; color:#ffd700; margin: 0 0 .25rem; letter-spacing:.12em; text-transform: uppercase; text-shadow: 0 0 4px #000, 0 0 10px rgba(255,215,0,.8); }
    .subtitle-main{ font-family: "Orbitron", sans-serif; font-size: 30pt; color:#ffd700; margin: 0; letter-spacing:.1em;  text-transform: uppercase; text-shadow: 0 0 3px #000, 0 0 8px rgba(255,215,0,.7); }

    .series-grid { display:flex; flex-direction:column; align-items:center; margin-top:100px; }
    .button-row  { display:flex; gap:2rem; justify-content:center; width:100%; max-width:1100px; }
    .button-row + .button-row { margin-top: 75px; }
    .series-btn {
      display:inline-flex; align-items:center; justify-content:center;
      width:100%; padding:1rem 1.5rem; border-radius:999px; border:1px solid #fff;
      font-size:12pt; font-weight:700; letter-spacing:.03em; text-transform:uppercase;
      background-image: linear-gradient(135deg, #011926 0%, #003E5C 100%);
      color:#B29433; box-shadow: 0 4px 0 #000, 0 16px 30px rgba(0,0,0,.95), inset 0 1px 0 rgba(255,255,255,.08), inset 0 -3px 10px rgba(0,0,0,.95);
      cursor:pointer; text-align:center; line-height:1.3; transition: transform .16s, box-shadow .16s, border-color .16s;
    }
    .series-btn:hover { transform: translateY(-2px) scale(1.02); border-color:#f9fafb; box-shadow: 0 6px 0 #000, 0 22px 38px rgba(0,0,0,.98), 0 0 18px rgba(211,175,55,.6), inset 0 1px 0 rgba(255,255,255,.12), inset 0 -3px 12px rgba(0,0,0,.98); }
    .series-btn:active{ transform: translateY(1px) scale(.99); box-shadow: 0 2px 0 #000, 0 10px 18px rgba(0,0,0,.98), inset 0 1px 0 rgba(255,255,255,.06), inset 0 -2px 6px rgba(0,0,0,.98); }
    .series-btn-placeholder { visibility:hidden; pointer-events:none; }

    .return-link {
      display:none; margin:.75rem auto 0; font-family:"Orbitron",sans-serif; font-size:.9rem; letter-spacing:.18em; text-transform:uppercase;
      color:#fff; cursor:pointer; opacity:.9; padding:.4rem 1.5rem; border-radius:999px; border:.5px solid #ffd700; transition:.14s; width:fit-content; text-align:center;
    }
    .return-link:hover { opacity:1; text-shadow:0 0 4px #000, 0 0 10px rgba(250,204,107,.9); transform: translateY(-1px); }

    .cards-grid { display:none; flex-direction:column; align-items:center; margin-top:100px; }
    .cards-row  { display:flex; flex-wrap:wrap; gap:1.5rem; justify-content:center; width:100%; max-width:1100px; }

    .character-card {
      flex: 0 1 18%; max-width:260px; padding:1.5rem 1.75rem; border-radius:18px;
      background-image: linear-gradient(135deg, #011926 0%, #003E5C 100%);
      border:1px solid #fff; color:#B29433; font-size:12pt; font-weight:700; letter-spacing:.04em; text-transform:uppercase; text-align:center;
      box-shadow: 0 4px 0 #000, 0 16px 30px rgba(0,0,0,.95), inset 0 1px 0 rgba(255,255,255,.08), inset 0 -3px 10px rgba(0,0,0,.95);
      transition: transform .16s, box-shadow .16s, border-color .16s; cursor:pointer;
      display:flex; flex-direction:column; gap:.65rem;
    }
    .character-card:hover { transform: translateY(-2px) scale(1.02); border-color:#f9fafb; box-shadow: 0 6px 0 #000, 0 22px 38px rgba(0,0,0,.98), 0 0 18px rgba(211,175,55,.6), inset 0 1px 0 rgba(255,255,255,.12), inset 0 -3px 12px rgba(0,0,0,.98); }
    .character-card > img { display: block !important; width: 100% !important; height: auto !important; }

    .card-text { display:flex; flex-direction:column; align-items:flex-start; gap:4px; min-height:72px;  text-align: center; align-items: center; }
    .card-text a { text-decoration:none;  text-align: center; margin-left: auto; margin-right: auto; }
    .card-text .character-name  { color:#fff; font-weight:600; }
    .card-text .character-title { color:gold; margin:0;  text-align: center; margin-left: auto; margin-right: auto; }
    .card-text .character-actor { color:limegreen; font-weight:700; -webkit-text-stroke:.5px #000; text-stroke:.5px #000;  text-align: center; margin-left: auto; margin-right: auto; }

    /* Keep TOS static extras visible only in TOS */
    .series-non-tos .character-card.tos-only { display:none !important; }

    /* Bio view headers */
    .bio-header, h1,h2,h3,h4,h5,h6 { color:gold; font-weight:700; }
  </style>
</head>
<body>
  <header>
    <h1 class="title-main">Bio Trek</h1>
    <h2 class="subtitle-main">Star Trek Biographies</h2>
  </header>
  <main>
    <div class="series-wrapper">
      <div id="return-menu" class="return-link">Return to Series Menu</div>

      <!-- MENU (8 buttons restored) -->
      <div class="series-grid">
        <div class="button-row">
          <button type="button" class="series-btn" data-series="The Original Series">The Original Series</button>
          <button type="button" class="series-btn" data-series="The Next Generation">The Next Generation</button>
          <button type="button" class="series-btn" data-series="Deep Space Nine">Deep Space Nine</button>
        </div>
        <div class="button-row">
          <button type="button" class="series-btn" data-series="Voyager">Voyager</button>
          <button type="button" class="series-btn" data-series="Enterprise">Enterprise</button>
          <button type="button" class="series-btn" data-series="Discovery">Discovery</button>
        </div>
        <div class="button-row">
          <button type="button" class="series-btn" data-series="Picard">Picard</button>
          <button type="button" class="series-btn" data-series="Strange New Worlds">Strange New Worlds</button>
          <button type="button" class="series-btn series-btn-placeholder" aria-hidden="true" tabindex="-1"></button>
        </div>
      </div>

      <!-- CARDS GRID (top-3 placeholders + static TOS extras) -->
      <div class="cards-grid">
        <div class="cards-row">
          <article class="character-card" id="card-1">
            <img id="card-1-img" alt=""/>
            <div id="card-1-text" class="card-text"></div>
          </article>
          <article class="character-card" id="card-2">
            <img id="card-2-img" alt=""/>
            <div id="card-2-text" class="card-text"></div>
          </article>
          <article class="character-card" id="card-3">
            <img id="card-3-img" alt=""/>
            <div id="card-3-text" class="card-text"></div>
          </article>

          <!-- TOS static extras (unchanged) -->
          <article class="character-card tos-only">
            <img alt="Montgomery Scott (TOS)" src="https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Scotty%20(TOS).png"/>
            <div class="card-text">
              <a class="character-name" href="#">Montgomery Scott</a>
              <p class="character-title">Chief Engineer</p>
              <a class="character-actor" href="#">James Doohan</a>
            </div>
          </article>
          <article class="character-card tos-only">
            <img alt="Nyota Uhura (TOS)" src="https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Uhura%20(TOS).png"/>
            <div class="card-text">
              <a class="character-name" href="#">Nyota Uhura</a>
              <p class="character-title">Communications Officer</p>
              <a class="character-actor" href="#">Nichelle Nichols</a>
            </div>
          </article>
          <article class="character-card tos-only">
            <img alt="Hikaru Sulu (TOS)" src="https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Sulu%20(TOS).png"/>
            <div class="card-text">
              <a class="character-name" href="#">Hikaru Sulu</a>
              <p class="character-title">Helmsman</p>
              <a class="character-actor" href="#">George Takei</a>
            </div>
          </article>
          <article class="character-card tos-only">
            <img alt="Pavel Chekov (TOS)" src="https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Chekov%20(TOS).png"/>
            <div class="card-text">
              <a class="character-name" href="#">Pavel Chekov</a>
              <p class="character-title">Navigator</p>
              <a class="character-actor" href="#">Walter Koenig</a>
            </div>
          </article>
          <article class="character-card tos-only">
            <img alt="Yeoman Janice Rand (TOS)" src="https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Yeoman%20Rand%20(TOS).png"/>
            <div class="card-text">
              <a class="character-name" href="#">Yeoman Janice Rand</a>
              <p class="character-title">Yeoman</p>
              <a class="character-actor" href="#">Grace Lee Whitney</a>
            </div>
          </article>
          <article class="character-card tos-only">
            <img alt="Nurse Christine Chapel (TOS)" src="https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Christine%20Chapel%20(TOS).png"/>
            <div class="card-text">
              <a class="character-name" href="#">Nurse Christine Chapel</a>
              <p class="character-title">Nurse</p>
              <a class="character-actor" href="#">Majel Barett Roddenberry</a>
            </div>
          </article>
        </div>
      </div>
    </div>
  </main>

  <!-- BIO OVERLAY AREA (non-destructive) -->
  <div id="bio-overlay" style="display:none; padding:2rem 7.5rem; max-width:1200px; margin:50px auto;"></div>

  <script>

    // ===== Helpers =====
    const $  = (s, r=document) => r.querySelector(s);
    const $$ = (s, r=document) => r.querySelectorAll(s);

    const titleEl = $(".title-main");
    const subtitleEl = $(".subtitle-main");
    const seriesMenu = $(".series-grid");
    const cardsGrid  = $(".cards-grid");
    const returnMenu = $("#return-menu");
    const bioOverlay = $("#bio-overlay");

    function esc(s){ return String(s).replace(/[&<>]/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;'}[m])); }
    function simpleNorm(s){ return String(s||'').toLowerCase().normalize('NFKD').replace(/[\\u0300-\\u036f]/g,'').replace(/[''`\\.\\-]/g,'').replace(/\\s+/g,'').trim(); }

    // ===== Data (cards) =====
    const SERIES = {
      TOS: [
        { name:"James T. Kirk", role:"Captain",            actor:"William Shatner", img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/James%20Kirk%20(TOS).png" },
        { name:"Spock",         role:"Lt. Commander",      actor:"Leonard Nimoy",   img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Spock%20(TOS).png" },
        { name:"Leonard (Bones) McCoy", role:"Doctor",     actor:"DeForest Kelley", img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Doctor%20McCoy%20(TOS).png" }
      ],
      TNG: [
        { name:"Jean-Luc Picard",    role:"Captain",             actor:"Patrick Stewart",        img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Jean-Luc%20Picard%20(TNG).png" },
        { name:"William T. Riker",   role:"First Officer",       actor:"Jonathan Frakes",        img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/William%20T%20Riker%20(TNG).png" },
        { name:"Data",               role:"Operations",          actor:"Brent Spiner",           img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Data%20(TNG).png" },
        { name:"Reginald Barclay",   role:"Engineer",            actor:"Dwight Schultz",         img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Barclay%20(TNG).png" },
        { name:"Beverly Crusher",    role:"Chief Medical Officer", actor:"Gates McFadden",      img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Beverly%20Crusher%20(TNG).png" },
        { name:"Miles O'Brien",      role:"Transporter Chief",   actor:"Colm Meaney",            img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Chief%20O'Brien%20(TNG).png" },
        { name:"Guinan",             role:"Ten Forward Host",    actor:"Whoopi Goldberg",        img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Guinan%20(TNG).png" },
        { name:"Tasha Yar",          role:"Security Chief",      actor:"Denise Crosby",          img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Tasha%20Yar%20(TNG).png" },
        { name:"Deanna Troi",        role:"Counselor",           actor:"Marina Sirtis",          img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Troi%20(TNG).png" },
        { name:"Worf",               role:"Tactical/Security",   actor:"Michael Dorn",           img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Worf%20(TNG).png" }
      ],
      DS9: [
        { name:"Benjamin Sisko",     role:"Commander/Captain",   actor:"Avery Brooks",           img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Benjamin%20Sisko%20(DS9).png" },
        { name:"Kira Nerys",         role:"First Officer",       actor:"Nana Visitor",           img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Major%20Kira%20(DS9).png" },
        { name:"Worf",               role:"Strategic Ops",       actor:"Michael Dorn",           img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Worf%20(DS9).png" },
        { name:"Jadzia Dax",         role:"Science Officer",     actor:"Terry Farrell",          img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Jadzia%20Dax%20(DS9).png" },
        { name:"Dr. Julian Bashir",  role:"Chief Medical Officer", actor:"Alexander Siddig",   img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Doctor%20Bashir%20(DS9).png" },
        { name:"Miles O'Brien",      role:"Chief of Operations", actor:"Colm Meaney",            img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Chief%20O'Brien%20(DS9).png" },
        { name:"Odo",                role:"Security Chief",      actor:"Ren\u00e9 Auberjonois",  img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Odo%20(DS9).png" },
        { name:"Quark",              role:"Bartender",           actor:"Armin Shimerman",        img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Quark%20(DS9).png" }
      ],
      VOY: [
        { name:"Kathryn Janeway",    role:"Captain",             actor:"Kate Mulgrew",           img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Kathry%20Janeway%20(Voy).png" },
        { name:"Chakotay",           role:"First Officer",       actor:"Robert Beltran",         img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Chakotay%20(Voy).png" },
        { name:"Tuvok",              role:"Security/Tactical",   actor:"Tim Russ",               img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Tuvok%20(Voy).png" },
        { name:"Tom Paris",          role:"Helmsman",            actor:"Robert Duncan McNeill",  img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Tom%20Paris%20(VOY).png" },
        { name:"B'Elanna Torres",    role:"Chief Engineer",      actor:"Roxann Dawson",          img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/B'Elanna%20Torres%20(VOY).png" },
        { name:"Harry Kim",          role:"Operations",          actor:"Garrett Wang",           img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Harry%20Kim%20(VOY).png" },
        { name:"Seven of Nine",      role:"Astrometrics",        actor:"Jeri Ryan",              img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Seven%20of%20Nine%20(VOY).png" },
        { name:"The Doctor",         role:"Chief Medical Officer", actor:"Robert Picardo",      img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/The%20Doctor%20(VOY).png" },
        { name:"Neelix",             role:"Morale Officer",      actor:"Ethan Phillips",         img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Neelix%20(VOY).png" }
      ],
      ENT: [
        { name:"Jonathan Archer",    role:"Captain",             actor:"Scott Bakula",           img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Jonathan%20Archer%20(Ent).png" },
        { name:"Charles \"Trip\" Tucker III", role:"Chief Engineer", actor:"Connor Trinneer",   img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Trip%20Tucker%20(Ent).png" },
        { name:"T'Pol",             role:"Science Officer",      actor:"Jolene Blalock",         img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/TPol%20(Ent).png" },
        { name:"Malcolm Reed",      role:"Tactical Officer",     actor:"Dominic Keating",        img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Malcolm%20Reed.png" },
        { name:"Travis Mayweather", role:"Helmsman",             actor:"Anthony Montgomery",     img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Travis%20Mayweathere.png" },
        { name:"Hoshi Sato",        role:"Communications Officer", actor:"Linda Park",          img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Hoshi%20Sato.png" },
        { name:"Doctor Phlox",      role:"Chief Medical Officer", actor:"John Billingsley",     img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Doctor%20Phlox.png" }
      ],
      DIS: [], PIC: [], SNW: [
        { name:"Christopher Pike", role:"Captain", actor:"Anson Mount", img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Christopher%20Pike.png" },
        { name:"Una Chin Riley", role:"First Officer", actor:"Rebecca Romijn", img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Una%20Chin%20Riley.png" },
        { name:"Spock", role:"Science Officer", actor:"Ethan Peck", img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Spock%20(SNW).png" },
        { name:"Erica Ortegas", role:"Helm Officer", actor:"Melissa Navia", img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Erica%20Ortegas.png" },
        { name:"La'An Noonien-Singh", role:"Security Chief", actor:"Christina Chong", img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/La%E2%80%99An%20Noonien-Singh.png" },
        { name:"Nyota Uhura", role:"Communications", actor:"Celia Rose Gooding", img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Nyota%20Uhura.png" },
        { name:"Christine Chapel", role:"Nurse", actor:"Jess Bush", img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Christine%20Chapel.png" },
        { name:"Doctor M'Benga", role:"Chief Medical Officer", actor:"Babs Olusanmokun", img:"https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Images/Doctor%20M'Benga.png" }
      ]
    };

    // ===== Aliases for bios =====
    const ALIASES = {
      TOS: {
        crew: { "James T. Kirk":"James T Kirk","Leonard (Bones) McCoy":"Doctor McCoy","Nyota Uhura":"Uhura","Hikaru Sulu":"Sulu","Pavel Chekov":"Chekov","Yeoman Janice Rand":"Yeoman Rand","Nurse Christine Chapel":"Nurse Chapel","Montgomery Scott":"Scotty" },
        actor:{ "Majel Barett Roddenberry":"Majel Barett Roddenberry","Majel Barrett":"Majel Barett Roddenberry","Majel-Barett Roddenberry":"Majel Barett Roddenberry" }
      },
      DS9: {
        crew: { "Chief O'Brien":"Miles O'Brien","Lt. Commander Worf":"Worf","Elim Garak":"Garak","Miles O'Brien":"Miles Edward O'Brien","Chief Miles O'Brien":"Miles Edward O'Brien","Chief Miles Edward O'Brien":"Miles Edward O'Brien" },
        actor:{}
      }
      ,
      TNG: {
        crew: {
          "William T. Riker":"William Riker",
          "Reginald Barclay":"Barclay",
          "Miles O'Brien":"Miles O'Brien",
          "Lt. Commander Worf":"Worf",
          "Chief O'Brien":"Miles O'Brien"
        },
        actor: {}
      }
    
      
  , ENT: {
      crew: {
        "Doctor Phlox": "Phlox",
        "Dr. Phlox": "Phlox",
        "Dr Phlox": "Phlox",
        "Charles \"Trip\" Tucker III": "Charles \"Trip\" Tucker III",
        "Trip Tucker": "Charles \"Trip\" Tucker III"
      },
      actor: {}
    }

      ,
      SNW: {
        crew: {
          "Una Chin Riley":"Una Chin-Riley",
          "Una":"Una Chin-Riley",
          "Number One":"Una Chin-Riley",
          "Doctor M'Benga":"Dr. Joseph M'Benga",
          "Dr. M'Benga":"Dr. Joseph M'Benga",
          "M'Benga":"Dr. Joseph M'Benga"
        },
        actor: {}
      }
};

    // ===== JSON loaders =====
    async function fetchJSON(url){ const r=await fetch(url,{cache:'no-store'}); if(!r.ok) throw new Error(''+r.status); const d=await r.json(); return (d&&d.bios)?d.bios:d; }
    async function loadTOS(){ return fetchJSON("https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Biographies/Bios-TOS.json"); }
    async function loadDS9(){ return fetchJSON("https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Biographies/Bios-DS9.json"); }
    async function loadTNG(){ return fetchJSON("https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Biographies/Bios-TNG.json"); }
async function loadENT(){ return fetchJSON("https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Biographies/Bios-ENT.json"); }
    async function loadSNW(){ return fetchJSON("https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Biographies/Bios-SNW.json"); }

async function loadVOY(){ return fetchJSON("https://raw.githubusercontent.com/BigBird7827/Bio-Trek/main/Biographies/Bios-VOY.json"); }
function mapDs9Alias(n){
  var m = {
    "miles o'brien": "Chief O'Brien",
    "chief o'brien": "Chief O'Brien",
    "miles edward o'brien": "Chief O'Brien",
    "chief miles o'brien": "Chief O'Brien",
    "chief miles edward o'brien": "Chief O'Brien",
    "elim garak": "Garak",
    "lt. commander worf": "Worf"
  };
  var k = (n||'').toLowerCase();
  return Object.prototype.hasOwnProperty.call(m, k) ? m[k] : n;
}


    
    
    function resolve(ds, name, which, seriesKey){
      const display = (name||'').trim();

      const seriesAliases = (ALIASES[seriesKey] && ALIASES[seriesKey][which]) || {};
      const aliased = seriesAliases[display] || display;

      // Build robust candidate variants
      const cset = new Set();
      const straight = aliased.replace(/['`]/g, "'");
      const curly   = straight.replace(/'/g, "'");
      const noHyphen = straight.replace(/-/g, " ");
      const withHyphen = straight.replace(/\s+/g, " ").replace(/\b([A-Za-z])\s*-\s*([A-Za-z])/g, "$1-$2");
      const baseVariants = new Set([straight, curly, noHyphen, withHyphen]);
      baseVariants.forEach(v => {
        cset.add(v);
        cset.add(v.replace(/^Doctor\s+/i, "Dr. "));
        cset.add(v.replace(/^Dr\.\s+/i, "Doctor "));
        cset.add(v.replace(/^Dr\s+/i, "Dr. "));
      });
      const candidates = Array.from(cset);

      const dicts = which==='actor' ? [ds?.Actors, ds?.actors, ds?.actorBios, ds] : [ds?.Crew, ds?.crew, ds?.characters, ds];

      // Exact match pass
      for (const cand of candidates){
        for (const d of dicts){ if (d && d[cand]) return d[cand]; }
      }

      // Normalized match pass
      const norm = (s)=> String(s||'').toLowerCase().normalize('NFKD').replace(/[\u0300-\u036f]/g,'').replace(/[''`\.\-]/g,'').replace(/\s+/g,'').trim();
      for (const d of dicts){
        if (!d) continue;
        const keys = Object.keys(d);
        for (const k of keys){
          const nk = norm(k);
          for (const cand of candidates){
            if (norm(cand) === nk) return d[k];
          }
        }
      }
      return null;
    }

    // ===== Renderers =====
    function setTitles(key){
      if (titleEl)   titleEl.textContent = "Star Trek";
      if (subtitleEl) subtitleEl.textContent =
        key==='TOS' ? "The Original Series" :
        key==='TNG' ? "The Next Generation" :
        key==='DS9' ? "Deep Space Nine" :
        key==='VOY' ? "Voyager" :
        key==='ENT' ? "Enterprise" :
        key==='DIS' ? "Discovery" :
        key==='PIC' ? "Picard" :
        key==='SNW' ? "Strange New Worlds" : "";
    }
    function showCards(){
      seriesMenu.style.display = "none";
      cardsGrid.style.display  = "flex";
      returnMenu.style.display = "block";
      document.documentElement.classList.toggle("series-non-tos", subtitleEl.textContent !== "The Original Series");
      window.scrollTo({top:0, behavior:"instant"});
    }
    function clearTopThree(){
      ["1","2","3"].forEach(n => {
        const img = $("#card-"+n+"-img"); const txt = $("#card-"+n+"-text");
        if (img) { img.src = ""; img.removeAttribute("src"); img.alt=""; }
        if (txt) txt.innerHTML = "";
      });
    }
    function setTopThree(people){
      const top = people.slice(0,3);
      top.forEach((p,i)=>{
        const img = $("#card-"+(i+1)+"-img"); const txt = $("#card-"+(i+1)+"-text");
        if (!img || !txt) return;
        if (p && p.img) { img.src = p.img; img.alt = p.name; }
        txt.innerHTML = p ? (`
          <a href="#" class="character-name">${p.name}</a>
          <p class="character-title">${p.role||""}</p>
          <a href="#" class="character-actor">${p.actor||""}</a>
        `) : "";
      });
    }
    function clearExtras(){
      $$(".series-dynamic").forEach(el => el.remove());
    }
    function renderExtras(people, key){
      const host = $(".cards-row");
      people.slice(3).forEach(p => {
        const card = document.createElement("article");
        card.className = `character-card series-dynamic ${key.toLowerCase()}-only`;
        const img = document.createElement("img"); img.alt = p.name; if (p.img) img.src = p.img;
        const text = document.createElement("div"); text.className = "card-text";
        text.innerHTML = `
          <a href="#" class="character-name">${p.name}</a>
          <p class="character-title">${p.role||""}</p>
          <a href="#" class="character-actor">${p.actor||""}</a>`;
        card.appendChild(img); card.appendChild(text); host.appendChild(card);
      });
    }

    function labelToKey(label){
      const l=(label||"").toLowerCase();
      if (l.includes("original")) return "TOS";
      if (l.includes("next generation") || l.includes("tng")) return "TNG";
      if (l.includes("deep space nine") || l.includes("ds9")) return "DS9";
      if (l.includes("voyager") || l.includes("voy")) return "VOY";
      if (l.includes("enterprise") || l.includes("ent")) return "ENT";
      if (l.includes("discovery") || l.includes("dis")) return "DIS";
      if (l.includes("picard") || l.includes("pic")) return "PIC";
      if (l.includes("strange new worlds") || l.includes("snw")) return "SNW";
      return "";
    }

    function applySeries(key){

      setTitles(key);
      showCards();
      clearTopThree();
      clearExtras();
      // Toggle visibility of TOS-only extras
      const isTOS = key === "TOS";
      $$(".character-card.tos-only").forEach(c => c.style.display = isTOS ? "flex" : "none");

      const people = SERIES[key] || [];
      setTopThree(people);
      renderExtras(people, key);
      if (key === "SNW") {
        const cards = document.querySelectorAll(".cards-row .character-card");
        cards.forEach(async (card) => {
          const nameEl = card.querySelector(".character-name");
          const imgEl  = card.querySelector("img");
          if (!nameEl || !imgEl) return;
          // Only probe if still showing the fallback placeholder
          const isPlaceholder = (imgEl.src || "").startsWith("data:image/svg+xml");
          if (!isPlaceholder) return;
          const n = nameEl.textContent.trim();
          const found = await findSnwImage(n);
          if (found) { imgEl.src = found; }
        });
      }
    }

    // ===== Bio overlay (non-destructive to cards DOM) =====
    function renderBio(title, sections){
      const blocks = Array.isArray(sections) ? sections : [{header:"Biography", text:"No biography available."}];
      bioOverlay.innerHTML = [
        `<h1 style="font-family:Orbitron,sans-serif;color:white;text-align:center;font-size:1.5rem;">${esc(title)}</h1>`,
        `<div style="height:18px;"></div>`,
        ...blocks.map(s => `<h3 style="color:gold;font-weight:bold;margin-top:1.5rem;max-width:85%;margin:1.5rem auto 0;text-align:left;">${esc(s.header||"Biography")}</h3><p style="color:white;line-height:1.6;max-width:85%;margin:0.35rem auto 0;">${esc(s.text||"")}</p>`),
        `<div style="text-align:center;margin-top:2rem;"><button id="returnToCrew" style="padding:0.6rem 1.5rem;border:1px solid gold;border-radius:20px;background:transparent;color:gold;cursor:pointer;">Return to Crew</button></div>`
      ].join("");
      bioOverlay.style.display = "block";
      // hide the grid under it
      cardsGrid.style.display = "none";
      returnMenu.style.display = "block";
      window.scrollTo({top:0, behavior:"instant"});
    }
    function hideBio(){
      bioOverlay.style.display = "none";
      bioOverlay.innerHTML = "";
      cardsGrid.style.display = "flex";
      returnMenu.style.display = "block";
      window.scrollTo({top:0, behavior:"instant"});
    }

    // ===== Events =====
    document.addEventListener("click", async (e) => {
      // Menu buttons
      const btn = e.target.closest(".series-btn");
      if (btn && btn.hasAttribute("data-series")) {
        e.preventDefault();
        applySeries(labelToKey(btn.getAttribute("data-series") || btn.textContent));
        return;
      }
      // Return to menu
      if (e.target.closest("#return-menu")) {
        e.preventDefault();
        bioOverlay.style.display = "none";
        document.documentElement.classList.remove("series-non-tos");
        // Reset titles
        titleEl.textContent = "Bio Trek";
        subtitleEl.textContent = "Star Trek Biographies";
        // Show menu, hide grid
        seriesMenu.style.display = "flex";
        cardsGrid.style.display = "none";
        returnMenu.style.display = "none";
        return;
      }
      // Return from bio
      if (e.target && e.target.id === "returnToCrew") {
        e.preventDefault();
        hideBio();
        return;
      }

      // Card links: bios
      const nameLink  = e.target.closest("a.character-name");
      const actorLink = e.target.closest("a.character-actor");
      if (!nameLink && !actorLink) return;
      e.preventDefault();

      const series = (subtitleEl.textContent || "").toLowerCase();
      const isTOS  = series.includes("original");
      const isDS9  = series.includes("deep space nine");
      const isTNG  = series.includes("next generation") || series.includes("tng");
      const isENT  = series.includes("enterprise") || series.includes("ent");
      const isVOY  = series.includes("voyager") || series.includes("voy");
      const isSNW  = series.includes("strange new worlds") || series.includes("snw");
      const isOther = !(isTOS || isDS9 || isTNG || isENT || isVOY || isSNW);
      try {
        const which = nameLink ? "crew" : "actor";
        const text  = (nameLink ? nameLink : actorLink).textContent;
        if (isTOS) {
          const ds = await loadTOS();
          const sections = resolve(ds, text, which, "TOS") || [{header:"Biography", text:"Not found."}];
          renderBio(text, sections);
        } else if (isDS9) {
          const ds = await loadDS9();
          const sections = resolve(ds, text, which, "DS9") || [{header:"Biography", text:"Not found."}];
          renderBio(text, sections);
        } else if (isTNG) {
          const ds = await loadTNG();
          const sections = resolve(ds, text, which, "TNG") || [{header:"Biography", text:"Not found."}];
          renderBio(text, sections);
        } else if (isENT) {
          const ds = await loadENT();
          const sections = resolve(ds, text, which, "ENT") || [{header:"Biography", text:"Not found."}];
          renderBio(text, sections);
        }
        else if (isVOY) {
          const ds = await loadVOY();
          const sections = resolve(ds, text, which, "VOY") || [{header:"Biography", text:"Not found."}];
          renderBio(text, sections);
        }
        else if (isSNW) {
          const ds = await loadSNW();
          const sections = resolve(ds, text, which, "SNW") || [{header:"Biography", text:"Not found."}];
          renderBio(text, sections);
        } else {
          renderBio(text, [{header:"Biography", text:"This series is not wired to bios yet."}]);
        }
      }
      catch (err) {
        renderBio("Error", [{header:"Biography", text:"Failed to load biography data."}]);
      }
    });
  
    // Hardening: if inner spans or nodes are clicked inside the anchors, ensure we still catch the anchor.
    document.addEventListener("click", (e) => {
      const a = e.target.closest && e.target.closest("a");
      if (!a) return;
      if (a.classList && (a.classList.contains("character-name") || a.classList.contains("character-actor"))) {
        // let the main handler process it (already registered above)
      }
    }, true);
  
</script>

<script>

// Fallback handler to ensure TNG/ENT (and others) links open a placeholder bio
(function(){
  function $(s, r=document){ return r.querySelector(s); }
  const subtitle = document.querySelector(".subtitle-main");
  const cardsGrid = document.querySelector(".cards-grid");
  const returnMenu = document.getElementById("return-menu");
  const overlay = document.getElementById("bio-overlay");

  function esc(s){ return String(s).replace(/[&<>]/g, m=>({'&':'&amp;','<':'&lt;','>':'&gt;'}[m])); }
  function renderPlaceholder(title){
    if (!overlay) return;
    overlay.innerHTML = [
      '<h1 style="font-family:Orbitron,sans-serif;color:white;text-align:center;font-size:1.5rem;">' + esc(title) + '</h1>',
      '<div style="height:18px;"></div>',
      '<h3 style="color:gold;font-weight:bold;margin-top:1.5rem;max-width:85%;margin:1.5rem auto 0;text-align:left;">Biography</h3>',
      '<p style="color:white;line-height:1.6;max-width:85%;margin:0.35rem auto 0;">This series is not wired to bios yet.</p>',
      '<div style="text-align:center;margin-top:2rem;"><button id="returnToCrew" style="padding:0.6rem 1.5rem;border:1px solid gold;border-radius:20px;background:transparent;color:gold;cursor:pointer;">Return to Crew</button></div>'
    ].join("");
    overlay.style.display = "block";
    if (cardsGrid) cardsGrid.style.display = "none";
    if (returnMenu) returnMenu.style.display = "block";
    window.scrollTo({top:0, behavior:"instant"});
  }

  document.addEventListener("click", function(e){
    const a = e.target.closest && e.target.closest("a.character-name, a.character-actor");
    if (!a) return;
    const sub = (subtitle && subtitle.textContent || '').toLowerCase();
    const wiredTOS = sub.includes('original');
    const wiredDS9 = sub.includes('deep space nine');
    if (wiredTOS || wiredDS9) return;
    if (sub.includes('next generation') || sub.includes('tng')) return;
    if (sub.includes('enterprise') || sub.includes('ent')) return;
    if (sub.includes('next generation') || sub.includes('tng')) return; // let the main module handle these
    if (sub.includes('next generation') || sub.includes('tng') ||
        sub.includes('enterprise') || sub.includes('ent') ||
        sub.includes('voyager') || sub.includes('voy') ||
        sub.includes('discovery') || sub.includes('dis') ||
        sub.includes('picard') || sub.includes('pic') ||
        sub.includes('strange new worlds') || sub.includes('snw')) {
      e.preventDefault();
      renderPlaceholder(a.textContent.trim());
    }
  }, true);
})();

</script>

</body>
</html>
